# ‚úçÔ∏è Incolla in src/pages/ManualWineInsertPage.tsx questo codice completo:
import { useEffect, useState } from "react";
import { useUser } from "@supabase/auth-helpers-react";
import { createClient } from "@/utils/supabase/client";
import { useRouter } from "next/navigation";
import { Button } from "@/components/ui/button";
import { toast } from "sonner";

const supabase = createClient();

export default function ManualWineInsertPage() {
  const user = useUser();
  const router = useRouter();
  const [wineList, setWineList] = useState("");
  const [categorie, setCategorie] = useState([]);
  const [fornitori, setFornitori] = useState([]);
  const [selectedCategoria, setSelectedCategoria] = useState("");
  const [selectedFornitore, setSelectedFornitore] = useState("");

  useEffect(() => {
    if (!user) return;
    const loadData = async () => {
      const { data: cat } = await supabase
        .from("categorie")
        .select("id, nome")
        .eq("user_id", user.id);
      setCategorie(cat || []);

      const { data: forn } = await supabase
        .from("fornitori")
        .select("id, nome")
        .eq("user_id", user.id);
      setFornitori(forn || []);
    };
    loadData();
  }, [user]);

  const salvaVini = (sostituisci: boolean) => {
    if (!wineList.trim()) {
      toast.error("Nessun vino da salvare");
      return;
    }
    if (!selectedCategoria) {
      toast.error("Seleziona una categoria");
      return;
    }

    const lista = wineList
      .split("\n")
      .map((riga) => riga.trim())
      .filter((r) => r.length > 0)
      .map((nome) => ({
        nome,
        tipo: selectedCategoria,
        fornitore: selectedFornitore || "",
        soglia_minima: 0,
        costo: 0,
      }));

    if (sostituisci) {
      localStorage.setItem("vini", JSON.stringify(lista));
      toast.success(`${lista.length} vini salvati (sostituiti) in ${selectedCategoria}`);
    } else {
      const esistenti = JSON.parse(localStorage.getItem("vini") || "[]");
      const nuovaLista = [...esistenti, ...lista];
      localStorage.setItem("vini", JSON.stringify(nuovaLista));
      toast.success(`${lista.length} vini aggiunti a ${selectedCategoria}`);
    }

    setWineList("");
  };

  return (
    <div className="p-4 text-white">
      <h1 className="text-2xl font-bold mb-2 text-center">üç∑ INSERIMENTO MANUALE VINI</h1>
      <p className="text-center text-sm text-gray-300 mb-4">
        Incolla qui sotto uno o pi√π nomi di vini, uno per riga
      </p>

      <textarea
        className="w-full h-40 p-2 mb-4 rounded bg-gray-900 text-white"
        placeholder="Es: Barolo DOCG 2020\nChianti Classico DOCG 2021"
        value={wineList}
        onChange={(e) => setWineList(e.target.value)}
      />

      <div className="mb-4">
        <label className="block mb-1 text-sm">Categoria</label>
        <select
          value={selectedCategoria}
          onChange={(e) => setSelectedCategoria(e.target.value)}
          className="w-full p-2 rounded bg-gray-800 text-white"
        >
          <option value="">‚Äî Seleziona categoria ‚Äî</option>
          {categorie.map((cat) => (
            <option key={cat.id} value={cat.nome}>
              {cat.nome}
            </option>
          ))}
        </select>
      </div>

      <div className="mb-6">
        <label className="block mb-1 text-sm">Fornitore (opzionale)</label>
        <select
          value={selectedFornitore}
          onChange={(e) => setSelectedFornitore(e.target.value)}
          className="w-full p-2 rounded bg-gray-800 text-white"
        >
          <option value="">‚Äî Nessuno ‚Äî</option>
          {fornitori.map((f) => (
            <option key={f.id} value={f.nome}>
              {f.nome}
            </option>
          ))}
        </select>
      </div>

      <div className="flex gap-2 justify-center">
        <Button className="bg-green-700 text-white" onClick={() => salvaVini(false)}>
          ‚ûï AGGIUNGI a lista esistente
        </Button>
        <Button className="bg-red-700 text-white" onClick={() => salvaVini(true)}>
          üß® SOSTITUISCI lista esistente
        </Button>
      </div>

      <p className="text-center mt-6 text-sm text-gray-400">
        I vini vengono salvati temporaneamente nel browser.<br />
        Sincronizzazione futura con il database prevista.
      </p>
    </div>
  );
}
