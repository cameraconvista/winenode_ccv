var Gr=Object.defineProperty;var Jr=(t,r,a)=>r in t?Gr(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var tt=(t,r,a)=>(Jr(t,typeof r!="symbol"?r+"":r,a),a);import{r as l,a as Yr,R as Ge,c as Xr,b as Zr}from"./vendor-c28bf532.js";import{_ as dr,c as Kr}from"./supabase-41ff009f.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();var ur={exports:{}},jt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qr=l,ea=Symbol.for("react.element"),ta=Symbol.for("react.fragment"),ra=Object.prototype.hasOwnProperty,aa=Qr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sa={key:!0,ref:!0,__self:!0,__source:!0};function mr(t,r,a){var s,n={},o=null,c=null;a!==void 0&&(o=""+a),r.key!==void 0&&(o=""+r.key),r.ref!==void 0&&(c=r.ref);for(s in r)ra.call(r,s)&&!sa.hasOwnProperty(s)&&(n[s]=r[s]);if(t&&t.defaultProps)for(s in r=t.defaultProps,r)n[s]===void 0&&(n[s]=r[s]);return{$$typeof:ea,type:t,key:o,ref:c,props:n,_owner:aa.current}}jt.Fragment=ta;jt.jsx=mr;jt.jsxs=mr;ur.exports=jt;var e=ur.exports,At={},Zt=Yr;At.createRoot=Zt.createRoot,At.hydrateRoot=Zt.hydrateRoot;var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.parse=ua;Dt.serialize=ma;const na=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,oa=/^[\u0021-\u003A\u003C-\u007E]*$/,ia=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,la=/^[\u0020-\u003A\u003D-\u007E]*$/,ca=Object.prototype.toString,da=(()=>{const t=function(){};return t.prototype=Object.create(null),t})();function ua(t,r){const a=new da,s=t.length;if(s<2)return a;const n=(r==null?void 0:r.decode)||ha;let o=0;do{const c=t.indexOf("=",o);if(c===-1)break;const x=t.indexOf(";",o),u=x===-1?s:x;if(c>u){o=t.lastIndexOf(";",c-1)+1;continue}const i=Kt(t,o,c),d=Qt(t,c,i),p=t.slice(i,d);if(a[p]===void 0){let g=Kt(t,c+1,u),j=Qt(t,u,g);const f=n(t.slice(g,j));a[p]=f}o=u+1}while(o<s);return a}function Kt(t,r,a){do{const s=t.charCodeAt(r);if(s!==32&&s!==9)return r}while(++r<a);return a}function Qt(t,r,a){for(;r>a;){const s=t.charCodeAt(--r);if(s!==32&&s!==9)return r+1}return a}function ma(t,r,a){const s=(a==null?void 0:a.encode)||encodeURIComponent;if(!na.test(t))throw new TypeError(`argument name is invalid: ${t}`);const n=s(r);if(!oa.test(n))throw new TypeError(`argument val is invalid: ${r}`);let o=t+"="+n;if(!a)return o;if(a.maxAge!==void 0){if(!Number.isInteger(a.maxAge))throw new TypeError(`option maxAge is invalid: ${a.maxAge}`);o+="; Max-Age="+a.maxAge}if(a.domain){if(!ia.test(a.domain))throw new TypeError(`option domain is invalid: ${a.domain}`);o+="; Domain="+a.domain}if(a.path){if(!la.test(a.path))throw new TypeError(`option path is invalid: ${a.path}`);o+="; Path="+a.path}if(a.expires){if(!pa(a.expires)||!Number.isFinite(a.expires.valueOf()))throw new TypeError(`option expires is invalid: ${a.expires}`);o+="; Expires="+a.expires.toUTCString()}if(a.httpOnly&&(o+="; HttpOnly"),a.secure&&(o+="; Secure"),a.partitioned&&(o+="; Partitioned"),a.priority)switch(typeof a.priority=="string"?a.priority.toLowerCase():void 0){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${a.priority}`)}if(a.sameSite)switch(typeof a.sameSite=="string"?a.sameSite.toLowerCase():a.sameSite){case!0:case"strict":o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"none":o+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${a.sameSite}`)}return o}function ha(t){if(t.indexOf("%")===-1)return t;try{return decodeURIComponent(t)}catch{return t}}function pa(t){return ca.call(t)==="[object Date]"}var er="popstate";function fa(t={}){function r(s,n){let{pathname:o,search:c,hash:x}=s.location;return zt("",{pathname:o,search:c,hash:x},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function a(s,n){return typeof n=="string"?n:nt(n)}return xa(r,a,null,t)}function fe(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function ze(t,r){if(!t){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function ga(){return Math.random().toString(36).substring(2,10)}function tr(t,r){return{usr:t.state,key:t.key,idx:r}}function zt(t,r,a=null,s){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof r=="string"?Ye(r):r,state:a,key:r&&r.key||s||ga()}}function nt({pathname:t="/",search:r="",hash:a=""}){return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function Ye(t){let r={};if(t){let a=t.indexOf("#");a>=0&&(r.hash=t.substring(a),t=t.substring(0,a));let s=t.indexOf("?");s>=0&&(r.search=t.substring(s),t=t.substring(0,s)),t&&(r.pathname=t)}return r}function xa(t,r,a,s={}){let{window:n=document.defaultView,v5Compat:o=!1}=s,c=n.history,x="POP",u=null,i=d();i==null&&(i=0,c.replaceState({...c.state,idx:i},""));function d(){return(c.state||{idx:null}).idx}function p(){x="POP";let S=d(),C=S==null?null:S-i;i=S,u&&u({action:x,location:w.location,delta:C})}function g(S,C){x="PUSH";let k=zt(w.location,S,C);a&&a(k,S),i=d()+1;let N=tr(k,i),z=w.createHref(k);try{c.pushState(N,"",z)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;n.location.assign(z)}o&&u&&u({action:x,location:w.location,delta:1})}function j(S,C){x="REPLACE";let k=zt(w.location,S,C);a&&a(k,S),i=d();let N=tr(k,i),z=w.createHref(k);c.replaceState(N,"",z),o&&u&&u({action:x,location:w.location,delta:0})}function f(S){return ba(S)}let w={get action(){return x},get location(){return t(n,c)},listen(S){if(u)throw new Error("A history only accepts one active listener");return n.addEventListener(er,p),u=S,()=>{n.removeEventListener(er,p),u=null}},createHref(S){return r(n,S)},createURL:f,encodeLocation(S){let C=f(S);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:g,replace:j,go(S){return c.go(S)}};return w}function ba(t,r=!1){let a="http://localhost";typeof window<"u"&&(a=window.location.origin!=="null"?window.location.origin:window.location.href),fe(a,"No window.location.(origin|href) available to create URL");let s=typeof t=="string"?t:nt(t);return s=s.replace(/ $/,"%20"),!r&&s.startsWith("//")&&(s=a+s),new URL(s,a)}function hr(t,r,a="/"){return ya(t,r,a,!1)}function ya(t,r,a,s){let n=typeof r=="string"?Ye(r):r,o=Fe(n.pathname||"/",a);if(o==null)return null;let c=pr(t);va(c);let x=null;for(let u=0;x==null&&u<c.length;++u){let i=Ta(o);x=Ra(c[u],i,s)}return x}function pr(t,r=[],a=[],s=""){let n=(o,c,x)=>{let u={relativePath:x===void 0?o.path||"":x,caseSensitive:o.caseSensitive===!0,childrenIndex:c,route:o};u.relativePath.startsWith("/")&&(fe(u.relativePath.startsWith(s),`Absolute route path "${u.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(s.length));let i=De([s,u.relativePath]),d=a.concat(u);o.children&&o.children.length>0&&(fe(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${i}".`),pr(o.children,r,d,i)),!(o.path==null&&!o.index)&&r.push({path:i,score:Ea(i,o.index),routesMeta:d})};return t.forEach((o,c)=>{var x;if(o.path===""||!((x=o.path)!=null&&x.includes("?")))n(o,c);else for(let u of fr(o.path))n(o,c,u)}),r}function fr(t){let r=t.split("/");if(r.length===0)return[];let[a,...s]=r,n=a.endsWith("?"),o=a.replace(/\?$/,"");if(s.length===0)return n?[o,""]:[o];let c=fr(s.join("/")),x=[];return x.push(...c.map(u=>u===""?o:[o,u].join("/"))),n&&x.push(...c),x.map(u=>t.startsWith("/")&&u===""?"/":u)}function va(t){t.sort((r,a)=>r.score!==a.score?a.score-r.score:Ia(r.routesMeta.map(s=>s.childrenIndex),a.routesMeta.map(s=>s.childrenIndex)))}var wa=/^:[\w-]+$/,ja=3,Na=2,ka=1,Sa=10,Ca=-2,rr=t=>t==="*";function Ea(t,r){let a=t.split("/"),s=a.length;return a.some(rr)&&(s+=Ca),r&&(s+=Na),a.filter(n=>!rr(n)).reduce((n,o)=>n+(wa.test(o)?ja:o===""?ka:Sa),s)}function Ia(t,r){return t.length===r.length&&t.slice(0,-1).every((s,n)=>s===r[n])?t[t.length-1]-r[r.length-1]:0}function Ra(t,r,a=!1){let{routesMeta:s}=t,n={},o="/",c=[];for(let x=0;x<s.length;++x){let u=s[x],i=x===s.length-1,d=o==="/"?r:r.slice(o.length)||"/",p=vt({path:u.relativePath,caseSensitive:u.caseSensitive,end:i},d),g=u.route;if(!p&&i&&a&&!s[s.length-1].route.index&&(p=vt({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},d)),!p)return null;Object.assign(n,p.params),c.push({params:n,pathname:De([o,p.pathname]),pathnameBase:Oa(De([o,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(o=De([o,p.pathnameBase]))}return c}function vt(t,r){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[a,s]=La(t.path,t.caseSensitive,t.end),n=r.match(a);if(!n)return null;let o=n[0],c=o.replace(/(.)\/+$/,"$1"),x=n.slice(1);return{params:s.reduce((i,{paramName:d,isOptional:p},g)=>{if(d==="*"){let f=x[g]||"";c=o.slice(0,o.length-f.length).replace(/(.)\/+$/,"$1")}const j=x[g];return p&&!j?i[d]=void 0:i[d]=(j||"").replace(/%2F/g,"/"),i},{}),pathname:o,pathnameBase:c,pattern:t}}function La(t,r=!1,a=!0){ze(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let s=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,x,u)=>(s.push({paramName:x,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,r?void 0:"i"),s]}function Ta(t){try{return t.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return ze(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${r}).`),t}}function Fe(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let a=r.endsWith("/")?r.length-1:r.length,s=t.charAt(a);return s&&s!=="/"?null:t.slice(a)||"/"}function Aa(t,r="/"){let{pathname:a,search:s="",hash:n=""}=typeof t=="string"?Ye(t):t;return{pathname:a?a.startsWith("/")?a:za(a,r):r,search:Ma(s),hash:Da(n)}}function za(t,r){let a=r.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?a.length>1&&a.pop():n!=="."&&a.push(n)}),a.length>1?a.join("/"):"/"}function Rt(t,r,a,s){return`Cannot include a '${t}' character in a manually specified \`to.${r}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _a(t){return t.filter((r,a)=>a===0||r.route.path&&r.route.path.length>0)}function gr(t){let r=_a(t);return r.map((a,s)=>s===r.length-1?a.pathname:a.pathnameBase)}function xr(t,r,a,s=!1){let n;typeof t=="string"?n=Ye(t):(n={...t},fe(!n.pathname||!n.pathname.includes("?"),Rt("?","pathname","search",n)),fe(!n.pathname||!n.pathname.includes("#"),Rt("#","pathname","hash",n)),fe(!n.search||!n.search.includes("#"),Rt("#","search","hash",n)));let o=t===""||n.pathname==="",c=o?"/":n.pathname,x;if(c==null)x=a;else{let p=r.length-1;if(!s&&c.startsWith("..")){let g=c.split("/");for(;g[0]==="..";)g.shift(),p-=1;n.pathname=g.join("/")}x=p>=0?r[p]:"/"}let u=Aa(n,x),i=c&&c!=="/"&&c.endsWith("/"),d=(o||c===".")&&a.endsWith("/");return!u.pathname.endsWith("/")&&(i||d)&&(u.pathname+="/"),u}var De=t=>t.join("/").replace(/\/\/+/g,"/"),Oa=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Ma=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Da=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Fa(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var br=["POST","PUT","PATCH","DELETE"];new Set(br);var Pa=["GET",...br];new Set(Pa);var Xe=l.createContext(null);Xe.displayName="DataRouter";var Nt=l.createContext(null);Nt.displayName="DataRouterState";var yr=l.createContext({isTransitioning:!1});yr.displayName="ViewTransition";var Ua=l.createContext(new Map);Ua.displayName="Fetchers";var Ba=l.createContext(null);Ba.displayName="Await";var _e=l.createContext(null);_e.displayName="Navigation";var ct=l.createContext(null);ct.displayName="Location";var Pe=l.createContext({outlet:null,matches:[],isDataRoute:!1});Pe.displayName="Route";var Ft=l.createContext(null);Ft.displayName="RouteError";function $a(t,{relative:r}={}){fe(dt(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:s}=l.useContext(_e),{hash:n,pathname:o,search:c}=ut(t,{relative:r}),x=o;return a!=="/"&&(x=o==="/"?a:De([a,o])),s.createHref({pathname:x,search:c,hash:n})}function dt(){return l.useContext(ct)!=null}function qe(){return fe(dt(),"useLocation() may be used only in the context of a <Router> component."),l.useContext(ct).location}var vr="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function wr(t){l.useContext(_e).static||l.useLayoutEffect(t)}function Oe(){let{isDataRoute:t}=l.useContext(Pe);return t?ts():Wa()}function Wa(){fe(dt(),"useNavigate() may be used only in the context of a <Router> component.");let t=l.useContext(Xe),{basename:r,navigator:a}=l.useContext(_e),{matches:s}=l.useContext(Pe),{pathname:n}=qe(),o=JSON.stringify(gr(s)),c=l.useRef(!1);return wr(()=>{c.current=!0}),l.useCallback((u,i={})=>{if(ze(c.current,vr),!c.current)return;if(typeof u=="number"){a.go(u);return}let d=xr(u,JSON.parse(o),n,i.relative==="path");t==null&&r!=="/"&&(d.pathname=d.pathname==="/"?r:De([r,d.pathname])),(i.replace?a.replace:a.push)(d,i.state,i)},[r,a,o,n,t])}l.createContext(null);function ut(t,{relative:r}={}){let{matches:a}=l.useContext(Pe),{pathname:s}=qe(),n=JSON.stringify(gr(a));return l.useMemo(()=>xr(t,JSON.parse(n),s,r==="path"),[t,n,s,r])}function Va(t,r){return jr(t,r)}function jr(t,r,a,s){var C;fe(dt(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:n}=l.useContext(_e),{matches:o}=l.useContext(Pe),c=o[o.length-1],x=c?c.params:{},u=c?c.pathname:"/",i=c?c.pathnameBase:"/",d=c&&c.route;{let k=d&&d.path||"";Nr(u,!d||k.endsWith("*")||k.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${k}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${k}"> to <Route path="${k==="/"?"*":`${k}/*`}">.`)}let p=qe(),g;if(r){let k=typeof r=="string"?Ye(r):r;fe(i==="/"||((C=k.pathname)==null?void 0:C.startsWith(i)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${i}" but pathname "${k.pathname}" was given in the \`location\` prop.`),g=k}else g=p;let j=g.pathname||"/",f=j;if(i!=="/"){let k=i.replace(/^\//,"").split("/");f="/"+j.replace(/^\//,"").split("/").slice(k.length).join("/")}let w=hr(t,{pathname:f});ze(d||w!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),ze(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let S=Ya(w&&w.map(k=>Object.assign({},k,{params:Object.assign({},x,k.params),pathname:De([i,n.encodeLocation?n.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?i:De([i,n.encodeLocation?n.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),o,a,s);return r&&S?l.createElement(ct.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},S):S}function qa(){let t=es(),r=Fa(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),a=t instanceof Error?t.stack:null,s="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:s},o={padding:"2px 4px",backgroundColor:s},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=l.createElement(l.Fragment,null,l.createElement("p",null,"💿 Hey developer 👋"),l.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",l.createElement("code",{style:o},"ErrorBoundary")," or"," ",l.createElement("code",{style:o},"errorElement")," prop on your route.")),l.createElement(l.Fragment,null,l.createElement("h2",null,"Unexpected Application Error!"),l.createElement("h3",{style:{fontStyle:"italic"}},r),a?l.createElement("pre",{style:n},a):null,c)}var Ha=l.createElement(qa,null),Ga=class extends l.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?l.createElement(Pe.Provider,{value:this.props.routeContext},l.createElement(Ft.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Ja({routeContext:t,match:r,children:a}){let s=l.useContext(Xe);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),l.createElement(Pe.Provider,{value:t},a)}function Ya(t,r=[],a=null,s=null){if(t==null){if(!a)return null;if(a.errors)t=a.matches;else if(r.length===0&&!a.initialized&&a.matches.length>0)t=a.matches;else return null}let n=t,o=a==null?void 0:a.errors;if(o!=null){let u=n.findIndex(i=>i.route.id&&(o==null?void 0:o[i.route.id])!==void 0);fe(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),n=n.slice(0,Math.min(n.length,u+1))}let c=!1,x=-1;if(a)for(let u=0;u<n.length;u++){let i=n[u];if((i.route.HydrateFallback||i.route.hydrateFallbackElement)&&(x=u),i.route.id){let{loaderData:d,errors:p}=a,g=i.route.loader&&!d.hasOwnProperty(i.route.id)&&(!p||p[i.route.id]===void 0);if(i.route.lazy||g){c=!0,x>=0?n=n.slice(0,x+1):n=[n[0]];break}}}return n.reduceRight((u,i,d)=>{let p,g=!1,j=null,f=null;a&&(p=o&&i.route.id?o[i.route.id]:void 0,j=i.route.errorElement||Ha,c&&(x<0&&d===0?(Nr("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,f=null):x===d&&(g=!0,f=i.route.hydrateFallbackElement||null)));let w=r.concat(n.slice(0,d+1)),S=()=>{let C;return p?C=j:g?C=f:i.route.Component?C=l.createElement(i.route.Component,null):i.route.element?C=i.route.element:C=u,l.createElement(Ja,{match:i,routeContext:{outlet:u,matches:w,isDataRoute:a!=null},children:C})};return a&&(i.route.ErrorBoundary||i.route.errorElement||d===0)?l.createElement(Ga,{location:a.location,revalidation:a.revalidation,component:j,error:p,children:S(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):S()},null)}function Pt(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Xa(t){let r=l.useContext(Xe);return fe(r,Pt(t)),r}function Za(t){let r=l.useContext(Nt);return fe(r,Pt(t)),r}function Ka(t){let r=l.useContext(Pe);return fe(r,Pt(t)),r}function Ut(t){let r=Ka(t),a=r.matches[r.matches.length-1];return fe(a.route.id,`${t} can only be used on routes that contain a unique "id"`),a.route.id}function Qa(){return Ut("useRouteId")}function es(){var s;let t=l.useContext(Ft),r=Za("useRouteError"),a=Ut("useRouteError");return t!==void 0?t:(s=r.errors)==null?void 0:s[a]}function ts(){let{router:t}=Xa("useNavigate"),r=Ut("useNavigate"),a=l.useRef(!1);return wr(()=>{a.current=!0}),l.useCallback(async(n,o={})=>{ze(a.current,vr),a.current&&(typeof n=="number"?t.navigate(n):await t.navigate(n,{fromRouteId:r,...o}))},[t,r])}var ar={};function Nr(t,r,a){!r&&!ar[t]&&(ar[t]=!0,ze(!1,a))}l.memo(rs);function rs({routes:t,future:r,state:a}){return jr(t,void 0,a,r)}function Le(t){fe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function as({basename:t="/",children:r=null,location:a,navigationType:s="POP",navigator:n,static:o=!1}){fe(!dt(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=t.replace(/^\/*/,"/"),x=l.useMemo(()=>({basename:c,navigator:n,static:o,future:{}}),[c,n,o]);typeof a=="string"&&(a=Ye(a));let{pathname:u="/",search:i="",hash:d="",state:p=null,key:g="default"}=a,j=l.useMemo(()=>{let f=Fe(u,c);return f==null?null:{location:{pathname:f,search:i,hash:d,state:p,key:g},navigationType:s}},[c,u,i,d,p,g,s]);return ze(j!=null,`<Router basename="${c}"> is not able to match the URL "${u}${i}${d}" because it does not start with the basename, so the <Router> won't render anything.`),j==null?null:l.createElement(_e.Provider,{value:x},l.createElement(ct.Provider,{children:r,value:j}))}function ss({children:t,location:r}){return Va(_t(t),r)}function _t(t,r=[]){let a=[];return l.Children.forEach(t,(s,n)=>{if(!l.isValidElement(s))return;let o=[...r,n];if(s.type===l.Fragment){a.push.apply(a,_t(s.props.children,o));return}fe(s.type===Le,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),fe(!s.props.index||!s.props.children,"An index route cannot have child routes.");let c={id:s.props.id||o.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(c.children=_t(s.props.children,o)),a.push(c)}),a}var xt="get",bt="application/x-www-form-urlencoded";function kt(t){return t!=null&&typeof t.tagName=="string"}function ns(t){return kt(t)&&t.tagName.toLowerCase()==="button"}function os(t){return kt(t)&&t.tagName.toLowerCase()==="form"}function is(t){return kt(t)&&t.tagName.toLowerCase()==="input"}function ls(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function cs(t,r){return t.button===0&&(!r||r==="_self")&&!ls(t)}var pt=null;function ds(){if(pt===null)try{new FormData(document.createElement("form"),0),pt=!1}catch{pt=!0}return pt}var us=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Lt(t){return t!=null&&!us.has(t)?(ze(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${bt}"`),null):t}function ms(t,r){let a,s,n,o,c;if(os(t)){let x=t.getAttribute("action");s=x?Fe(x,r):null,a=t.getAttribute("method")||xt,n=Lt(t.getAttribute("enctype"))||bt,o=new FormData(t)}else if(ns(t)||is(t)&&(t.type==="submit"||t.type==="image")){let x=t.form;if(x==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=t.getAttribute("formaction")||x.getAttribute("action");if(s=u?Fe(u,r):null,a=t.getAttribute("formmethod")||x.getAttribute("method")||xt,n=Lt(t.getAttribute("formenctype"))||Lt(x.getAttribute("enctype"))||bt,o=new FormData(x,t),!ds()){let{name:i,type:d,value:p}=t;if(d==="image"){let g=i?`${i}.`:"";o.append(`${g}x`,"0"),o.append(`${g}y`,"0")}else i&&o.append(i,p)}}else{if(kt(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=xt,s=null,n=bt,c=t}return o&&n==="text/plain"&&(c=o,o=void 0),{action:s,method:a.toLowerCase(),encType:n,formData:o,body:c}}function Bt(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}async function hs(t,r){if(t.id in r)return r[t.id];try{let a=await dr(()=>import(t.module),[],import.meta.url);return r[t.id]=a,a}catch(a){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ps(t){return t!=null&&typeof t.page=="string"}function fs(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function gs(t,r,a){let s=await Promise.all(t.map(async n=>{let o=r.routes[n.route.id];if(o){let c=await hs(o,a);return c.links?c.links():[]}return[]}));return vs(s.flat(1).filter(fs).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function sr(t,r,a,s,n,o){let c=(u,i)=>a[i]?u.route.id!==a[i].route.id:!0,x=(u,i)=>{var d;return a[i].pathname!==u.pathname||((d=a[i].route.path)==null?void 0:d.endsWith("*"))&&a[i].params["*"]!==u.params["*"]};return o==="assets"?r.filter((u,i)=>c(u,i)||x(u,i)):o==="data"?r.filter((u,i)=>{var p;let d=s.routes[u.route.id];if(!d||!d.hasLoader)return!1;if(c(u,i)||x(u,i))return!0;if(u.route.shouldRevalidate){let g=u.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:((p=a[0])==null?void 0:p.params)||{},nextUrl:new URL(t,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function xs(t,r,{includeHydrateFallback:a}={}){return bs(t.map(s=>{let n=r.routes[s.route.id];if(!n)return[];let o=[n.module];return n.clientActionModule&&(o=o.concat(n.clientActionModule)),n.clientLoaderModule&&(o=o.concat(n.clientLoaderModule)),a&&n.hydrateFallbackModule&&(o=o.concat(n.hydrateFallbackModule)),n.imports&&(o=o.concat(n.imports)),o}).flat(1))}function bs(t){return[...new Set(t)]}function ys(t){let r={},a=Object.keys(t).sort();for(let s of a)r[s]=t[s];return r}function vs(t,r){let a=new Set,s=new Set(r);return t.reduce((n,o)=>{if(r&&!ps(o)&&o.as==="script"&&o.href&&s.has(o.href))return n;let x=JSON.stringify(ys(o));return a.has(x)||(a.add(x),n.push({key:x,link:o})),n},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var ws=new Set([100,101,204,205]);function js(t,r){let a=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return a.pathname==="/"?a.pathname="_root.data":r&&Fe(a.pathname,r)==="/"?a.pathname=`${r.replace(/\/$/,"")}/_root.data`:a.pathname=`${a.pathname.replace(/\/$/,"")}.data`,a}function kr(){let t=l.useContext(Xe);return Bt(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Ns(){let t=l.useContext(Nt);return Bt(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var $t=l.createContext(void 0);$t.displayName="FrameworkContext";function Sr(){let t=l.useContext($t);return Bt(t,"You must render this element inside a <HydratedRouter> element"),t}function ks(t,r){let a=l.useContext($t),[s,n]=l.useState(!1),[o,c]=l.useState(!1),{onFocus:x,onBlur:u,onMouseEnter:i,onMouseLeave:d,onTouchStart:p}=r,g=l.useRef(null);l.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let w=C=>{C.forEach(k=>{c(k.isIntersecting)})},S=new IntersectionObserver(w,{threshold:.5});return g.current&&S.observe(g.current),()=>{S.disconnect()}}},[t]),l.useEffect(()=>{if(s){let w=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(w)}}},[s]);let j=()=>{n(!0)},f=()=>{n(!1),c(!1)};return a?t!=="intent"?[o,g,{}]:[o,g,{onFocus:rt(x,j),onBlur:rt(u,f),onMouseEnter:rt(i,j),onMouseLeave:rt(d,f),onTouchStart:rt(p,j)}]:[!1,g,{}]}function rt(t,r){return a=>{t&&t(a),a.defaultPrevented||r(a)}}function Ss({page:t,...r}){let{router:a}=kr(),s=l.useMemo(()=>hr(a.routes,t,a.basename),[a.routes,t,a.basename]);return s?l.createElement(Es,{page:t,matches:s,...r}):null}function Cs(t){let{manifest:r,routeModules:a}=Sr(),[s,n]=l.useState([]);return l.useEffect(()=>{let o=!1;return gs(t,r,a).then(c=>{o||n(c)}),()=>{o=!0}},[t,r,a]),s}function Es({page:t,matches:r,...a}){let s=qe(),{manifest:n,routeModules:o}=Sr(),{basename:c}=kr(),{loaderData:x,matches:u}=Ns(),i=l.useMemo(()=>sr(t,r,u,n,s,"data"),[t,r,u,n,s]),d=l.useMemo(()=>sr(t,r,u,n,s,"assets"),[t,r,u,n,s]),p=l.useMemo(()=>{if(t===s.pathname+s.search+s.hash)return[];let f=new Set,w=!1;if(r.forEach(C=>{var N;let k=n.routes[C.route.id];!k||!k.hasLoader||(!i.some(z=>z.route.id===C.route.id)&&C.route.id in x&&((N=o[C.route.id])!=null&&N.shouldRevalidate)||k.hasClientLoader?w=!0:f.add(C.route.id))}),f.size===0)return[];let S=js(t,c);return w&&f.size>0&&S.searchParams.set("_routes",r.filter(C=>f.has(C.route.id)).map(C=>C.route.id).join(",")),[S.pathname+S.search]},[c,x,s,n,i,r,t,o]),g=l.useMemo(()=>xs(d,n),[d,n]),j=Cs(d);return l.createElement(l.Fragment,null,p.map(f=>l.createElement("link",{key:f,rel:"prefetch",as:"fetch",href:f,...a})),g.map(f=>l.createElement("link",{key:f,rel:"modulepreload",href:f,...a})),j.map(({key:f,link:w})=>l.createElement("link",{key:f,...w})))}function Is(...t){return r=>{t.forEach(a=>{typeof a=="function"?a(r):a!=null&&(a.current=r)})}}var Cr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Cr&&(window.__reactRouterVersion="7.6.2")}catch{}function Rs({basename:t,children:r,window:a}){let s=l.useRef();s.current==null&&(s.current=fa({window:a,v5Compat:!0}));let n=s.current,[o,c]=l.useState({action:n.action,location:n.location}),x=l.useCallback(u=>{l.startTransition(()=>c(u))},[c]);return l.useLayoutEffect(()=>n.listen(x),[n,x]),l.createElement(as,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:n})}var Er=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ir=l.forwardRef(function({onClick:r,discover:a="render",prefetch:s="none",relative:n,reloadDocument:o,replace:c,state:x,target:u,to:i,preventScrollReset:d,viewTransition:p,...g},j){let{basename:f}=l.useContext(_e),w=typeof i=="string"&&Er.test(i),S,C=!1;if(typeof i=="string"&&w&&(S=i,Cr))try{let m=new URL(window.location.href),y=i.startsWith("//")?new URL(m.protocol+i):new URL(i),v=Fe(y.pathname,f);y.origin===m.origin&&v!=null?i=v+y.search+y.hash:C=!0}catch{ze(!1,`<Link to="${i}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let k=$a(i,{relative:n}),[N,z,F]=ks(s,g),X=zs(i,{replace:c,state:x,target:u,preventScrollReset:d,relative:n,viewTransition:p});function B(m){r&&r(m),m.defaultPrevented||X(m)}let h=l.createElement("a",{...g,...F,href:S||k,onClick:C||o?r:B,ref:Is(j,z),target:u,"data-discover":!w&&a==="render"?"true":void 0});return N&&!w?l.createElement(l.Fragment,null,h,l.createElement(Ss,{page:k})):h});Ir.displayName="Link";var Ls=l.forwardRef(function({"aria-current":r="page",caseSensitive:a=!1,className:s="",end:n=!1,style:o,to:c,viewTransition:x,children:u,...i},d){let p=ut(c,{relative:i.relative}),g=qe(),j=l.useContext(Nt),{navigator:f,basename:w}=l.useContext(_e),S=j!=null&&Fs(p)&&x===!0,C=f.encodeLocation?f.encodeLocation(p).pathname:p.pathname,k=g.pathname,N=j&&j.navigation&&j.navigation.location?j.navigation.location.pathname:null;a||(k=k.toLowerCase(),N=N?N.toLowerCase():null,C=C.toLowerCase()),N&&w&&(N=Fe(N,w)||N);const z=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let F=k===C||!n&&k.startsWith(C)&&k.charAt(z)==="/",X=N!=null&&(N===C||!n&&N.startsWith(C)&&N.charAt(C.length)==="/"),B={isActive:F,isPending:X,isTransitioning:S},h=F?r:void 0,m;typeof s=="function"?m=s(B):m=[s,F?"active":null,X?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let y=typeof o=="function"?o(B):o;return l.createElement(Ir,{...i,"aria-current":h,className:m,ref:d,style:y,to:c,viewTransition:x},typeof u=="function"?u(B):u)});Ls.displayName="NavLink";var Ts=l.forwardRef(({discover:t="render",fetcherKey:r,navigate:a,reloadDocument:s,replace:n,state:o,method:c=xt,action:x,onSubmit:u,relative:i,preventScrollReset:d,viewTransition:p,...g},j)=>{let f=Ms(),w=Ds(x,{relative:i}),S=c.toLowerCase()==="get"?"get":"post",C=typeof x=="string"&&Er.test(x),k=N=>{if(u&&u(N),N.defaultPrevented)return;N.preventDefault();let z=N.nativeEvent.submitter,F=(z==null?void 0:z.getAttribute("formmethod"))||c;f(z||N.currentTarget,{fetcherKey:r,method:F,navigate:a,replace:n,state:o,relative:i,preventScrollReset:d,viewTransition:p})};return l.createElement("form",{ref:j,method:S,action:w,onSubmit:s?u:k,...g,"data-discover":!C&&t==="render"?"true":void 0})});Ts.displayName="Form";function As(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Rr(t){let r=l.useContext(Xe);return fe(r,As(t)),r}function zs(t,{target:r,replace:a,state:s,preventScrollReset:n,relative:o,viewTransition:c}={}){let x=Oe(),u=qe(),i=ut(t,{relative:o});return l.useCallback(d=>{if(cs(d,r)){d.preventDefault();let p=a!==void 0?a:nt(u)===nt(i);x(t,{replace:p,state:s,preventScrollReset:n,relative:o,viewTransition:c})}},[u,x,i,a,s,r,t,n,o,c])}var _s=0,Os=()=>`__${String(++_s)}__`;function Ms(){let{router:t}=Rr("useSubmit"),{basename:r}=l.useContext(_e),a=Qa();return l.useCallback(async(s,n={})=>{let{action:o,method:c,encType:x,formData:u,body:i}=ms(s,r);if(n.navigate===!1){let d=n.fetcherKey||Os();await t.fetch(d,a,n.action||o,{preventScrollReset:n.preventScrollReset,formData:u,body:i,formMethod:n.method||c,formEncType:n.encType||x,flushSync:n.flushSync})}else await t.navigate(n.action||o,{preventScrollReset:n.preventScrollReset,formData:u,body:i,formMethod:n.method||c,formEncType:n.encType||x,replace:n.replace,state:n.state,fromRouteId:a,flushSync:n.flushSync,viewTransition:n.viewTransition})},[t,r,a])}function Ds(t,{relative:r}={}){let{basename:a}=l.useContext(_e),s=l.useContext(Pe);fe(s,"useFormAction must be used inside a RouteContext");let[n]=s.matches.slice(-1),o={...ut(t||".",{relative:r})},c=qe();if(t==null){o.search=c.search;let x=new URLSearchParams(o.search),u=x.getAll("index");if(u.some(d=>d==="")){x.delete("index"),u.filter(p=>p).forEach(p=>x.append("index",p));let d=x.toString();o.search=d?`?${d}`:""}}return(!t||t===".")&&n.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(o.pathname=o.pathname==="/"?a:De([a,o.pathname])),nt(o)}function Fs(t,r={}){let a=l.useContext(yr);fe(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Rr("useViewTransitionState"),n=ut(t,{relative:r.relative});if(!a.isTransitioning)return!1;let o=Fe(a.currentLocation.pathname,s)||a.currentLocation.pathname,c=Fe(a.nextLocation.pathname,s)||a.nextLocation.pathname;return vt(n.pathname,c)!=null||vt(n.pathname,o)!=null}[...ws];const Ps="https://jhyxxouaynjgvwapwmqg.supabase.co",Us="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpoeXh4b3VheW5qZ3Z3YXB3bXFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5NTEzMjUsImV4cCI6MjA2NjUyNzMyNX0.5npODmxo86ikUFxpKbuvQ_-oRXZ-h54TPPg5OmaYRCw",R=Kr(Ps,Us,{auth:{persistSession:!0,storage:localStorage,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce"},db:{schema:"public"}}),ee=!!R,Ve=class Ve{constructor(){tt(this,"currentUser",null);tt(this,"currentSession",null);tt(this,"listeners",[]);this.initializeAuth()}static getInstance(){return Ve.instance||(Ve.instance=new Ve),Ve.instance}async initializeAuth(){if(R)try{const{data:{session:r},error:a}=await R.auth.getSession();if(a){console.warn("Errore nel recupero sessione:",a.message),await R.auth.refreshSession();const{data:{session:n}}=await R.auth.getSession();this.currentSession=n,this.currentUser=(n==null?void 0:n.user)||null}else this.currentSession=r,this.currentUser=(r==null?void 0:r.user)||null;let s=null;R.auth.onAuthStateChange((n,o)=>{s&&clearTimeout(s),s=setTimeout(()=>{this.currentSession=o,this.currentUser=(o==null?void 0:o.user)||null,this.notifyListeners()},100)}),this.notifyListeners()}catch(r){console.error("Errore inizializzazione auth:",r)}}getCurrentUser(){return this.currentUser}getCurrentSession(){return this.currentSession}isAuthenticated(){return!!this.currentUser}getUserId(){var r;return((r=this.currentUser)==null?void 0:r.id)||null}async validateSession(){if(!R)return!1;try{const{data:{session:r},error:a}=await R.auth.getSession();if(a||!r){console.warn("Sessione non valida, tentativo refresh...");const{error:s}=await R.auth.refreshSession();if(s)return!1;const{data:{session:n}}=await R.auth.getSession();return this.currentSession=n,this.currentUser=(n==null?void 0:n.user)||null,!!n}return!0}catch(r){return console.error("Errore validazione sessione:",r),!1}}onAuthStateChange(r){return this.listeners.push(r),r(this.currentUser),()=>{this.listeners=this.listeners.filter(a=>a!==r)}}notifyListeners(){this.listeners.forEach(r=>r(this.currentUser))}async signIn(r,a){if(!R)throw new Error("Supabase non configurato");const{data:s,error:n}=await R.auth.signInWithPassword({email:r,password:a});if(n)throw n;return s}async signOut(){if(!R)throw new Error("Supabase non configurato");const{error:r}=await R.auth.signOut();if(r)throw r}async signUp(r,a){if(!R)throw new Error("Supabase non configurato");const{data:s,error:n}=await R.auth.signUp({email:r,password:a});if(n)throw n;return s}};tt(Ve,"instance");let wt=Ve;const q=wt.getInstance(),Bs=Object.freeze(Object.defineProperty({__proto__:null,AuthManager:wt,authManager:q,isSupabaseAvailable:ee,supabase:R},Symbol.toStringTag,{value:"Module"}));var $s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ws=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Vs=(t,r)=>{const a=l.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:c,children:x,...u},i)=>l.createElement("svg",{ref:i,...$s,width:n,height:n,stroke:s,strokeWidth:c?Number(o)*24/Number(n):o,className:`lucide lucide-${Ws(t)}`,...u},[...r.map(([d,p])=>l.createElement(d,p)),...(Array.isArray(x)?x:[x])||[]]));return a.displayName=`${t}`,a};var Q=Vs;const at=Q("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Lr=Q("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),qs=Q("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Wt=Q("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Je=Q("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),ot=Q("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Ot=Q("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Hs=Q("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Gs=Q("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Js=Q("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Ys=Q("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),nr=Q("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),Xs=Q("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),yt=Q("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),$e=Q("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Tr=Q("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Zs=Q("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Vt=Q("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),St=Q("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Ks=Q("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Ar=Q("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),qt=Q("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),it=Q("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Ct=Q("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),zr=Q("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Qs=Q("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),en=Q("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),Tt=Q("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),st=Q("Truck",[["path",{d:"M10 17h4V5H2v12h3",key:"1jq12e"}],["path",{d:"M20 17h2v-3.34a4 4 0 0 0-1.17-2.83L19 9h-5",key:"1xb3ft"}],["path",{d:"M14 17h1",key:"nufu4t"}],["circle",{cx:"7.5",cy:"17.5",r:"2.5",key:"a7aife"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),_r=Q("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Or=Q("UserCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),tn=Q("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),lt=Q("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ze=Q("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function rn({open:t,onOpenChange:r,filters:a,onFiltersChange:s}){if(!t)return null;const n=["","rosso","bianco","bollicine","rosato"],o=["","Cantina Valpolicella","Azienda Vinicola Piemontese","Tenuta Toscana","Cantina del Soave","Cantina Sarda","Villa Amagioia Varignana","Cantina Franciacorta","Cantina Valdobbiadene","Cantina Siciliana","Cantina Alto Adige","Cantina Abruzzese","Cantina Pugliese"];return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"fixed top-16 left-1/2 transform -translate-x-1/2 w-full max-w-md mx-4",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-cream",children:"Filtri"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-400 hover:text-cream",children:e.jsx(Ze,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tipo di vino"}),e.jsxs("select",{value:a.wineType,onChange:c=>s({...a,wineType:c.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-cream focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Tutti i tipi"}),n.slice(1).map(c=>e.jsx("option",{value:c,className:"capitalize",children:c},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Fornitore"}),e.jsxs("select",{value:a.supplier,onChange:c=>s({...a,supplier:c.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-cream focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Tutti i fornitori"}),o.slice(1).map(c=>e.jsx("option",{value:c,children:c},c))]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"showAlertsOnly",checked:a.showAlertsOnly,onChange:c=>s({...a,showAlertsOnly:c.target.checked}),className:"h-4 w-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"showAlertsOnly",className:"ml-2 text-sm text-gray-300",children:"Solo vini con scorte basse"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{onClick:()=>s({wineType:"",supplier:"",showAlertsOnly:!1}),className:"flex-1 px-4 py-2 bg-gray-700 text-cream rounded-lg hover:bg-gray-600 transition-colors",children:"Reset"}),e.jsx("button",{onClick:()=>r(!1),className:"flex-1 px-4 py-2 bg-blue-600 text-cream rounded-lg hover:bg-blue-700 transition-colors",children:"Applica"})]})]})})})}function an({wine:t,open:r,onOpenChange:a,onUpdateWine:s,suppliers:n=[]}){const[o,c]=l.useState({price:"",minStock:"",supplier:"",description:"",type:""}),[x,u]=l.useState(!1);if(l.useEffect(()=>{t&&c({price:t.price||"",minStock:t.minStock.toString(),supplier:t.supplier||"",description:t.description||"",type:t.type||""})},[t]),!r||!t)return null;const i=async()=>{u(!0);try{s&&await s(t.id,{price:o.price,minStock:parseInt(o.minStock)||2,supplier:o.supplier,description:o.description,type:o.type}),a(!1)}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-cream",children:t.name}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-cream",disabled:x,children:e.jsx(Ze,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Nome Vino *"}),e.jsx("input",{type:"text",value:t.name,disabled:!0,className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-gray-400 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Tipologia Vino"}),e.jsxs("select",{value:o.type,onChange:d=>c(p=>({...p,type:d.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Seleziona tipologia..."}),e.jsx("option",{value:"rosso",children:"Rosso"}),e.jsx("option",{value:"bianco",children:"Bianco"}),e.jsx("option",{value:"bollicine",children:"Bollicine"}),e.jsx("option",{value:"rosato",children:"Rosato"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Costo Vino (€)"}),e.jsx("input",{type:"text",value:o.price,onChange:d=>c(p=>({...p,price:d.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",placeholder:"Es: 15.50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Soglia Minima"}),e.jsx("input",{type:"number",value:o.minStock,onChange:d=>c(p=>({...p,minStock:d.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",placeholder:"2",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Fornitore"}),e.jsx("input",{type:"text",value:o.supplier,onChange:d=>c(p=>({...p,supplier:d.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",placeholder:"Inserisci il nome del fornitore"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Descrizione Completa"}),e.jsx("textarea",{value:o.description,onChange:d=>c(p=>({...p,description:d.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none resize-none",rows:2,placeholder:"Descrizione dettagliata del vino..."})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-t border-gray-700",children:[e.jsx("button",{onClick:()=>a(!1),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-cream rounded px-4 py-2 transition-colors",disabled:x,children:"Annulla"}),e.jsxs("button",{onClick:i,disabled:x,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-cream rounded px-4 py-2 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Ct,{className:"h-4 w-4"}),x?"Salvando...":"Salva"]})]})]})})}const ft=[];function Ht(){const[t,r]=l.useState([]),[a,s]=l.useState([]),[n,o]=l.useState([]),[c,x]=l.useState(!0),[u,i]=l.useState(null),[d,p]=l.useState(!1);l.useEffect(()=>q.onAuthStateChange(N=>{p(!!N),N?g():(r([]),s([]),o([]),x(!1))}),[]);const g=async()=>{if(x(!0),i(null),!ee){r(ft),s(Array.from(new Set(ft.map(N=>N.supplier)))),o([]),x(!1);return}if(!q.isAuthenticated()){i("Utente non autenticato"),x(!1);return}const k=q.getUserId();if(!k){i("ID utente non disponibile"),x(!1);return}try{const{data:N,error:z}=await R.from("vini").select("*").eq("user_id",k).order("nome_vino");if(z){if(z.code==="42P01"){r(ft),s(Array.from(new Set(ft.map(y=>y.supplier)))),o([]),x(!1);return}throw z}const F=(N||[]).map(y=>{var v;return{id:y.id,name:y.nome_vino,type:y.tipologia,supplier:y.fornitore,inventory:y.giacenza,minStock:y.min_stock??0,price:((v=y.prezzo_vendita)==null?void 0:v.toString())??"0",vintage:y.anno,region:y.provenienza,description:y.produttore}});r(F);const[{data:X,error:B},{data:h,error:m}]=await Promise.all([R.from("fornitori").select("nome").eq("user_id",k),R.from("tipologie").select("nome").eq("user_id",k)]);s(B?Array.from(new Set(F.map(y=>y.supplier))):(X||[]).map(y=>y.nome)),m?(console.error("Errore nel caricamento tipologie:",m),o([])):o((h||[]).map(y=>y.nome))}catch(N){console.error("Errore nel caricamento dei vini:",N),i(N instanceof Error?N.message:"Errore nel caricamento dei dati")}finally{x(!1)}},j=(k,N)=>{r(z=>z.map(F=>F.id===k?{...F,...N}:F))};return{wines:t,suppliers:a,types:n,loading:c,error:u,isAuthenticated:d,refreshWines:g,updateWineInventory:async(k,N)=>{if(!ee||!q.isAuthenticated())return console.error("Non autenticato"),!1;const z=q.getUserId();if(!z)return console.error("ID utente non disponibile"),!1;try{const{error:F}=await R.from("vini").update({giacenza:N,updated_at:new Date().toISOString()}).eq("id",k).eq("user_id",z);if(F)throw F;return j(k,{inventory:N}),!0}catch(F){return console.error("Errore aggiornamento giacenza:",F),!1}},updateWine:async(k,N)=>{if(!ee||!q.isAuthenticated())return console.error("Non autenticato"),!1;const z=q.getUserId();if(!z)return console.error("ID utente non disponibile"),!1;const F={updated_at:new Date().toISOString()};N.name!==void 0&&(F.nome=N.name),N.type!==void 0&&(F.tipo=N.type),N.supplier!==void 0&&(F.fornitore=N.supplier),N.inventory!==void 0&&(F.giacenza=N.inventory),N.minStock!==void 0&&(F.min_stock=N.minStock),N.price!==void 0&&(F.prezzo=parseFloat(N.price)),N.vintage!==void 0&&(F.annata=N.vintage),N.region!==void 0&&(F.regione=N.region),N.description!==void 0&&(F.descrizione=N.description);try{const{error:X}=await R.from("giacenze").update(F).eq("id",k).eq("user_id",z);if(X)throw X;return j(k,N),!0}catch(X){return console.error("Errore aggiornamento vino:",X),!1}},addWine:async k=>{if(!ee||!q.isAuthenticated())throw new Error("Non autenticato");const N=q.getUserId();if(!N)throw new Error("ID utente non disponibile");try{const{data:z,error:F}=await R.from("giacenze").insert({nome:k.name,tipo:k.type,fornitore:k.supplier,giacenza:k.inventory,min_stock:k.minStock,prezzo:parseFloat(k.price),annata:k.vintage,regione:k.region,descrizione:k.description,user_id:N,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(F)throw F;const X={id:z.id,name:z.nome,type:z.tipo,supplier:z.fornitore,inventory:z.giacenza,minStock:z.min_stock,price:z.prezzo.toString(),vintage:z.annata,region:z.regione,description:z.descrizione};return r(B=>[...B,X]),X}catch(z){throw console.error("Errore aggiunta vino:",z),z}},deleteWine:async k=>{if(!ee||!q.isAuthenticated())return console.error("Non autenticato"),!1;const N=q.getUserId();if(!N)return console.error("ID utente non disponibile"),!1;try{const{error:z}=await R.from("giacenze").delete().eq("id",k).eq("user_id",N);if(z)throw z;return r(F=>F.filter(X=>X.id!==k)),!0}catch(z){return console.error("Errore eliminazione vino:",z),!1}}}}function sn(){const t=Oe(),{wines:r,suppliers:a,loading:s,error:n,isAuthenticated:o,refreshWines:c,updateWineInventory:x,updateWine:u}=Ht(),[i,d]=l.useState(!1),[p,g]=l.useState(!1),[j,f]=l.useState(null),[w,S]=l.useState({wineType:"",supplier:"",showAlertsOnly:!1}),[C,k]=l.useState(!1),[N,z]=l.useState({name:"",type:"rosso",price:"",minStock:"2",supplier:"",description:""}),[F,X]=l.useState(!1),B=async(v,E)=>{await u(v,E)||console.error("Errore nell'aggiornamento del vino")},h=v=>{f(v),g(!0)},m=async()=>{if(N.name.trim()){X(!0);try{if(!ee||!q.isAuthenticated())throw new Error("Supabase non configurato o utente non autenticato");const v=q.getUserId();if(!v)throw new Error("ID utente non disponibile");const{data:E,error:T}=await R.from("giacenze").insert({name:N.name,type:N.type,supplier:N.supplier||"Da definire",inventory:0,min_stock:parseInt(N.minStock)||2,price:N.price||"0",vintage:null,region:null,description:N.description||null,user_id:v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(T)throw console.error("Errore nell'aggiunta vino su Supabase:",T),T;z({name:"",type:"rosso",price:"",minStock:"2",supplier:"",description:""}),k(!1),await c(),console.log("Vino aggiunto con successo:",E)}catch(v){console.error("Errore nell'aggiunta del vino:",v)}finally{X(!1)}}},y=r.filter(v=>{const E=!w.wineType||v.type===w.wineType,T=!w.supplier||v.supplier===w.supplier,Z=!w.showAlertsOnly||v.inventory<=v.minStock;return E&&T&&Z});return o?s?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-cream",children:"Caricamento vini..."})]})}):n?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-400 mb-4",children:n}),e.jsx("button",{onClick:c,className:"bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Riprova"})]})}):e.jsxs("div",{className:"h-screen max-h-screen overflow-hidden flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between h-20 sm:h-24",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>t("/settings/archivi"),className:"p-2 sm:p-2.5 text-white hover:text-gray-300 transition-colors","aria-label":"Archivi",title:"Archivi",children:e.jsx(Ot,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>d(!0),className:"p-2 sm:p-2.5 text-cream hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Filtri",children:e.jsx(Xs,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>t("/settings"),className:"p-2 sm:p-2.5 text-cream hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Impostazioni",children:e.jsx(zr,{className:"h-5 w-5"})})]})]})})})}),e.jsx("main",{className:"flex-1 flex flex-col max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-8 w-full overflow-y-auto",children:y.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400 text-lg",children:r.length===0?"Nessun vino nel tuo inventario":"Nessun vino trovato con i filtri selezionati"})}):e.jsx("div",{className:"space-y-2",children:y.map(v=>e.jsx("div",{className:"text-cream text-base p-2 hover:bg-white/5 rounded transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>h(v),className:"text-cream hover:text-amber-300 hover:underline text-base",children:v.name}),e.jsx("span",{className:"text-cream text-base",children:v.description||v.supplier||"-"}),e.jsx("span",{className:"text-cream text-base",children:v.inventory})]})},v.id))})}),e.jsx(rn,{open:i,onOpenChange:d,filters:w,onFiltersChange:S}),e.jsx(an,{wine:j,open:p,onOpenChange:g,onUpdateWine:B,suppliers:a}),!p&&e.jsx("button",{onClick:()=>k(!0),className:"fixed bottom-6 right-6 w-14 h-14 bg-black/30 backdrop-blur-sm hover:bg-black/40 text-amber-500 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-50 border border-red-900/30",title:"Aggiungi nuovo vino",children:e.jsx(qt,{className:"h-6 w-6"})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-cream",children:"AGGIUNGI NUOVO VINO"}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-cream",disabled:F,children:e.jsx(Ze,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Nome Vino *"}),e.jsx("input",{type:"text",value:N.name,onChange:v=>z(E=>({...E,name:v.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",placeholder:"Inserisci il nome del vino"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Colore Vino"}),e.jsxs("select",{value:N.type,onChange:v=>z(E=>({...E,type:v.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"rosso",children:"Rosso"}),e.jsx("option",{value:"bianco",children:"Bianco"}),e.jsx("option",{value:"bollicine",children:"Bollicine"}),e.jsx("option",{value:"rosato",children:"Rosato"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Costo Vino (€)"}),e.jsx("input",{type:"text",value:N.price||"",onChange:v=>z(E=>({...E,price:v.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",placeholder:"Es: 15.50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Soglia Minima"}),e.jsx("input",{type:"number",value:N.minStock||"2",onChange:v=>z(E=>({...E,minStock:v.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",placeholder:"2",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Fornitore"}),e.jsxs("select",{value:N.supplier||"",onChange:v=>z(E=>({...E,supplier:v.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Seleziona fornitore"}),a.map((v,E)=>e.jsx("option",{value:v,children:v},`${v}-${E}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Descrizione Completa"}),e.jsx("textarea",{value:N.description||"",onChange:v=>z(E=>({...E,description:v.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:border-blue-500 focus:outline-none resize-none",rows:2,placeholder:"Descrizione dettagliata del vino..."})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-t border-gray-700",children:[e.jsx("button",{onClick:()=>k(!1),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-cream rounded px-4 py-2 transition-colors",disabled:F,children:"Annulla"}),e.jsxs("button",{onClick:m,disabled:!N.name.trim()||F,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-cream rounded px-4 py-2 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Ct,{className:"h-4 w-4"}),F?"Aggiungendo...":"Salva"]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-cream",children:"Effettua l'accesso per vedere i tuoi vini"})})})}function Mr({open:t,onOpenChange:r,user:a}){var d,p;const[s,n]=l.useState(""),[o,c]=l.useState("utente"),[x,u]=l.useState(!1);l.useEffect(()=>{if(a&&t){const g=a.user_metadata||{};n(g.full_name||g.name||""),c(g.role||"utente")}},[a,t]);const i=async()=>{if(!s.trim()){alert("⚠️ Inserisci un nome valido");return}if(!ee||!R){alert("Modifica profilo non disponibile - servizio di autenticazione non configurato");return}u(!0);try{const{error:g}=await R.auth.updateUser({data:{full_name:s,role:o}});g?alert("❌ Errore durante l'aggiornamento del profilo: "+g.message):(alert(`✅ Profilo aggiornato con successo!

Nome: ${s}
Ruolo: ${o}`),r(!1),setTimeout(()=>window.location.reload(),1e3))}catch{alert("❌ Errore durante l'aggiornamento del profilo")}finally{u(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600/20 rounded-lg flex items-center justify-center",children:e.jsx(lt,{className:"w-5 h-5 text-blue-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-cream",children:"Gestione Profilo Utente"})]}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-400 hover:text-cream transition-colors",children:e.jsx(Ze,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nome completo"}),e.jsx("input",{type:"text",value:s,onChange:g=>n(g.target.value),placeholder:"Inserisci il tuo nome completo",className:"w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Ruolo utente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"role",value:"utente",checked:o==="utente",onChange:g=>c(g.target.value),className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-cream",children:"Utente"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"role",value:"admin",checked:o==="admin",onChange:g=>c(g.target.value),className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qs,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-cream",children:"Admin"})]})]})]})]}),a&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Informazioni attuali"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-400",children:[e.jsxs("div",{children:["Email: ",e.jsx("span",{className:"text-blue-400",children:a.email})]}),e.jsxs("div",{children:["Nome attuale: ",e.jsx("span",{className:"text-cream",children:((d=a.user_metadata)==null?void 0:d.full_name)||"Non impostato"})]}),e.jsxs("div",{children:["Ruolo attuale: ",e.jsx("span",{className:"text-yellow-400",children:((p=a.user_metadata)==null?void 0:p.role)||"utente"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-700",children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 text-gray-400 hover:text-cream transition-colors",children:"Annulla"}),e.jsx("button",{onClick:i,disabled:x,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-cream rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Salvataggio...":"Salva Modifiche"})]})]})}):null}function nn({onBack:t}){const[r,a]=l.useState(null),[s,n]=l.useState(!1);l.useEffect(()=>{(async()=>{if(!ee||!R)return;const{data:{user:w}}=await R.auth.getUser();w&&a(w)})()},[]);const o=async()=>{try{if(!ee||!R){localStorage.clear(),sessionStorage.clear(),window.location.href="/";return}const{error:f}=await R.auth.signOut();f&&(console.error("Errore durante il logout:",f),localStorage.clear(),sessionStorage.clear()),window.location.href="/"}catch(f){console.error("Errore durante il logout:",f),localStorage.clear(),sessionStorage.clear(),window.location.href="/"}},c=f=>{f==="logout"?o():f==="email"?x():f==="password"?u():f==="profile"?i():f==="notifications"?d():f==="reset"&&p()},x=()=>{const f=prompt("Inserisci il nuovo indirizzo email:",(r==null?void 0:r.email)||"");if(f&&f!==(r==null?void 0:r.email)){if(!ee||!R){alert("Modifica email non disponibile - servizio di autenticazione non configurato");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f)){alert("⚠️ Inserisci un indirizzo email valido");return}R.auth.updateUser({email:f}).then(({error:S})=>{alert(S?"❌ Errore durante la modifica dell'email: "+S.message:`✅ Richiesta di modifica email inviata!

Controlla la tua casella email attuale per confermare il cambiamento.`)})}},u=()=>{const f=prompt("Inserisci la nuova password (minimo 6 caratteri):");if(f){if(!ee||!R){alert("Modifica password non disponibile - servizio di autenticazione non configurato");return}if(f.length<6){alert("⚠️ La password deve essere di almeno 6 caratteri");return}R.auth.updateUser({password:f}).then(({error:w})=>{alert(w?"❌ Errore durante la modifica della password: "+w.message:"✅ Password aggiornata con successo!")})}},i=()=>{n(!0)},d=()=>{alert("Funzionalità notifiche in sviluppo")},p=()=>{confirm(`⚠️ ATTENZIONE!

Questa operazione eliminerà TUTTI i tuoi dati:
- Vini in archivio
- Fornitori
- Impostazioni personalizzate

Questa azione è IRREVERSIBILE.

Sei sicuro di voler continuare?`)&&confirm(`🔴 ULTIMA CONFERMA

Stai per eliminare DEFINITIVAMENTE tutti i tuoi dati.

Digita "CONFERMA" per procedere o annulla per tornare indietro.`)&&g()},g=async()=>{try{if(!ee||!R){localStorage.clear(),sessionStorage.clear(),alert("✅ Dati locali puliti con successo!"),window.location.href="/";return}const{data:{user:f}}=await R.auth.getUser();if(!f){alert("❌ Errore: utente non autenticato");return}const{error:w}=await R.from("giacenze").delete().eq("user_id",f.id);w&&console.error("Errore nell'eliminazione vini:",w);const{error:S}=await R.from("fornitori").delete().eq("user_id",f.id);S&&console.error("Errore nell'eliminazione fornitori:",S),localStorage.clear(),sessionStorage.clear(),alert(`✅ Reset completato con successo!

Tutti i tuoi dati sono stati eliminati.`),window.location.href="/"}catch(f){console.error("Errore durante il reset:",f),alert("❌ Errore durante il reset dei dati. Riprova.")}},j=[{id:"email",title:"EMAIL",icon:St},{id:"password",title:"PASSWORD",icon:Tr},{id:"profile",title:"PROFILO",icon:Or},{id:"notifications",title:"NOTIFICHE",icon:Wt},{id:"reset",title:"RESET",icon:it},{id:"logout",title:"ESCI",icon:Vt}];return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-cream hover:bg-gray-800 rounded-lg transition-colors",title:"Torna alle impostazioni",children:e.jsx(qs,{className:"h-5 w-5"})}),e.jsx("img",{src:"/logo2.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>window.location.href="/",className:"p-2 text-white hover:text-cream hover:bg-gray-800 rounded-lg transition-colors",title:"Vai alla home",style:{filter:"brightness(1.2)",color:"#ffffff"},children:e.jsx($e,{className:"h-6 w-6"})})]})})}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"space-y-4",children:j.map(f=>{const w=f.icon;return e.jsx("div",{onClick:()=>c(f.id),className:"bg-gray-800/50 border border-gray-700 p-4 rounded-xl text-left transition-all duration-200 group hover:bg-gray-700/50 hover:border-gray-600 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-gray-700/50 rounded-lg group-hover:bg-gray-600/50 transition-colors",children:e.jsx(w,{className:"h-5 w-5 text-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-bold text-cream",children:f.title}),f.id==="email"&&(r==null?void 0:r.email)&&e.jsxs("p",{className:"text-xs text-blue-400 mt-1",children:["Attuale: ",r.email]})]})]})},f.id)})}),e.jsx(Mr,{open:s,onOpenChange:n,user:r})]})]})}const Gt=()=>{const[t,r]=l.useState([]),[a,s]=l.useState(!0),[n,o]=l.useState(null),c=async()=>{try{if(s(!0),o(null),!await q.validateSession()){console.log("⚠️ Sessione non valida, fornitori vuoti"),r([]),s(!1);return}const p=q.getUserId();if(console.log("User ID:",p),!p){console.log("⚠️ SUPPLIERS: Utente non autenticato"),r([]),s(!1);return}const{data:g,error:j}=await R.from("fornitori").select("id, nome, email, telefono, created_at").eq("user_id",p).order("nome");j?(console.error("Errore caricamento fornitori:",j.message),o(j.message),r([])):(r(g||[]),console.log("✅ Fornitori caricati:",(g==null?void 0:g.length)||0))}catch(d){console.error("Errore nel caricamento fornitori:",d),o(d instanceof Error?d.message:"Errore sconosciuto"),r([])}finally{s(!1)}};return l.useEffect(()=>{(async()=>{if(!q.isAuthenticated()||!R){console.log("🔍 useSuppliers: Non autenticato o Supabase non disponibile"),s(!1);return}try{s(!0),o(null);const p=q.getUserId();if(!p){console.warn("🔍 useSuppliers: User ID non disponibile"),r([]),s(!1);return}console.log("🔍 useSuppliers: Caricamento fornitori per user:",p);const{data:g,error:j}=await R.from("fornitori").select("*").eq("user_id",p).order("nome");j?(console.error("❌ useSuppliers: Errore query:",j),o(j.message),r([])):(console.log("✅ useSuppliers: Caricati",(g==null?void 0:g.length)||0,"fornitori:",g),r(g||[]))}catch(p){console.error("❌ useSuppliers: Errore generale:",p),o(p instanceof Error?p.message:"Errore sconosciuto"),r([])}finally{s(!1)}})()},[]),{suppliers:t,isLoading:a,error:n,refreshSuppliers:()=>{s(!0),c()},addSupplier:async(d,p,g)=>{try{if(!ee)return console.error("Supabase non disponibile"),!1;const j=q.getUserId();if(!j)return console.error("User ID non disponibile"),!1;console.log("🔄 Tentativo inserimento fornitore:",{nome:d,email:p,telefono:g});const{data:f,error:w}=await R.from("fornitori").select("id, nome").eq("user_id",j).eq("nome",d.trim().toUpperCase()).limit(1);if(w)return console.error("Errore controllo duplicati fornitori:",w),!1;if(f&&f.length>0)return console.error("❌ Fornitore già esistente su Supabase:",d),!1;const{data:S,error:C}=await R.from("fornitori").insert({user_id:j,nome:d.trim().toUpperCase(),email:p.trim(),telefono:g.trim()}).select("id, nome, email, telefono, created_at").single();return C?(console.error("❌ Errore inserimento fornitore:",C),C.code==="23505"?console.error("Errore: Fornitore duplicato"):C.code==="42501"&&console.error("Errore: Permessi insufficienti (RLS)"),!1):(console.log("✅ Fornitore aggiunto con successo:",S),await c(),!0)}catch(j){return console.error("❌ Errore inaspettato in addSupplier:",j),!1}},updateSupplier:async(d,p,g,j)=>{try{if(await c(),t.some(z=>z.id!==d&&z.nome.toLowerCase()===p.toLowerCase()))return console.error("Nome fornitore già esistente:",p),!1;const w=q.getUserId();if(!w)return console.error("User ID non disponibile"),!1;const{data:S,error:C}=await R.from("fornitori").select("id").eq("user_id",w).eq("nome",p.trim()).neq("id",d).limit(1);if(C)return console.error("Errore controllo duplicati fornitori:",C),!1;if(S&&S.length>0)return console.error("Fornitore già esistente su Supabase:",p),!1;const{data:k,error:N}=await R.from("fornitori").update({nome:p.trim(),email:g.trim(),telefono:j.trim(),updated_at:new Date().toISOString()}).eq("id",d).select().single();return N?(console.error("Errore aggiornamento fornitore:",N),!1):(console.log("✅ Fornitore aggiornato:",k),await c(),!0)}catch(f){return console.error("Errore in updateSupplier:",f),!1}}}};function Dr({isOpen:t,onClose:r,onSupplierAdded:a}){const[s,n]=l.useState(""),[o,c]=l.useState(""),[x,u]=l.useState(""),[i,d]=l.useState(!1),[p,g]=l.useState(""),{addSupplier:j}=Gt(),f=async C=>{if(C.preventDefault(),console.log("🔄 MODAL SUBMIT - Dati:",{nome:s,email:o,telefono:x}),console.log("🔄 MODAL SUBMIT - Auth check:",{isSupabaseAvailable:ee,isAuth:q.isAuthenticated()}),!s.trim()||!o.trim()||!x.trim()){console.log("❌ MODAL: Campi mancanti"),g("Tutti i campi sono obbligatori");return}if(!ee||!q.isAuthenticated()){console.log("❌ MODAL: Errore autenticazione"),g("Errore di autenticazione");return}d(!0),g("");try{console.log("🔄 MODAL: Chiamata addSupplier...");const k=await j(s.trim().toUpperCase(),o.trim(),x.trim());console.log("🔄 MODAL: Risultato addSupplier:",k),k?(console.log("✅ MODAL: Fornitore aggiunto con successo"),n(""),c(""),u(""),console.log("🔄 MODAL: Chiamata onSupplierAdded..."),a(),setTimeout(()=>{console.log("🔄 MODAL: Chiusura forzata"),r()},100)):(console.log("❌ MODAL: Fallimento addSupplier"),g("Impossibile aggiungere il fornitore. Potrebbe già esistere."))}catch(k){console.error("❌ MODAL: Errore nell'aggiunta del fornitore:",k),g(`Errore inaspettato: ${k.message||"Operazione fallita"}`)}finally{console.log("🔄 MODAL: Fine operazione, loading=false"),d(!1)}},w=()=>{i||(n(""),c(""),u(""),g(""),r())},S=C=>{n(C.target.value.toUpperCase())};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800/90 border border-gray-700 rounded-xl w-full max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-cream",children:"NUOVO FORNITORE"}),e.jsx("button",{onClick:w,disabled:i,className:"p-2 text-gray-400 hover:text-cream hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(Ze,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[p&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/30 text-red-300 p-3 rounded-lg text-sm",children:p}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nome Fornitore *"}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx("input",{type:"text",value:s,onChange:S,placeholder:"NOME FORNITORE",className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent uppercase",disabled:i,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Fornitore *"}),e.jsxs("div",{className:"relative",children:[e.jsx(St,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx("input",{type:"email",value:o,onChange:C=>c(C.target.value),placeholder:"es: info@cantinagaja.it",className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",disabled:i,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Numero WhatsApp *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ar,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx("input",{type:"tel",value:x,onChange:C=>u(C.target.value),placeholder:"es: 3331234567",className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",disabled:i,required:!0})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:w,disabled:i,className:"flex-1 px-4 py-3 bg-gray-600 hover:bg-gray-500 text-white font-medium rounded-lg transition-colors disabled:opacity-50",children:"Annulla"}),e.jsxs("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-3 bg-amber-500 hover:bg-amber-600 text-black font-medium rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[i?e.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}):e.jsx(Ct,{className:"h-4 w-4"}),i?"Salvando...":"Salva"]})]})]})]})}):null}function Fr({isOpen:t,onClose:r,onSupplierUpdated:a,supplier:s}){const[n,o]=l.useState(""),[c,x]=l.useState(""),[u,i]=l.useState(""),[d,p]=l.useState(!1),[g,j]=l.useState("");l.useEffect(()=>{s&&(o(s.nome),x(s.email),i(s.telefono))},[s]);const f=async C=>{if(C.preventDefault(),!n.trim()||!c.trim()||!u.trim()){j("Tutti i campi sono obbligatori");return}if(!ee||!q.isAuthenticated()||!s){j("Errore di autenticazione");return}p(!0),j("");try{const{data:k,error:N}=await R.from("fornitori").update({nome:n.trim(),email:c.trim(),telefono:u.trim()}).eq("id",s.id).select().single();if(N){console.error("Errore Supabase:",N),N.code==="23505"?j("Un fornitore con questi dati esiste già"):N.code==="42501"?j("Permessi insufficienti. Verifica la configurazione RLS"):j(`Errore database: ${N.message}`);return}console.log("Fornitore modificato con successo:",k),a()}catch(k){console.error("Errore nella modifica del fornitore:",k),j(`Errore inaspettato: ${k.message||"Operazione fallita"}`)}finally{p(!1)}},w=()=>{d||(j(""),r())},S=C=>{o(C.target.value.toUpperCase())};return!t||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800/90 border border-gray-700 rounded-xl w-full max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-cream",children:"MODIFICA FORNITORE"}),e.jsx("button",{onClick:w,disabled:d,className:"p-2 text-gray-400 hover:text-cream hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(Ze,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[g&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/30 text-red-300 p-3 rounded-lg text-sm",children:g}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nome Fornitore *"}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx("input",{type:"text",value:n,onChange:S,placeholder:"NOME FORNITORE",className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent uppercase",disabled:d,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Fornitore *"}),e.jsxs("div",{className:"relative",children:[e.jsx(St,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx("input",{type:"email",value:c,onChange:C=>x(C.target.value),placeholder:"es: info@cantinagaja.it",className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",disabled:d,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Numero WhatsApp *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ar,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx("input",{type:"tel",value:u,onChange:C=>i(C.target.value),placeholder:"es: 3331234567",className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",disabled:d,required:!0})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:w,disabled:d,className:"flex-1 px-4 py-3 bg-gray-600 hover:bg-gray-500 text-white font-medium rounded-lg transition-colors disabled:opacity-50",children:"Annulla"}),e.jsxs("button",{type:"submit",disabled:d,className:"flex-1 px-4 py-3 bg-amber-500 hover:bg-amber-600 text-black font-medium rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[d?e.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}):e.jsx(Ct,{className:"h-4 w-4"}),d?"Salvando...":"Salva Modifiche"]})]})]})]})})}function on(){const t=Oe(),[r,a]=l.useState(null),[s,n]=l.useState(!1),[o,c]=l.useState(!1),[x,u]=l.useState(null),{suppliers:i,isLoading:d,error:p,refreshSuppliers:g}=Gt(),j=[{id:"account",title:"ACCOUNT",icon:lt},{id:"database",title:"ARCHIVIO VINI",icon:Ot}],f=w=>{u(w),c(!0)};return r==="account"?e.jsx(nn,{onBack:()=>a(null)}):r==="database"?e.jsxs("div",{className:"min-h-screen overflow-y-auto flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:()=>a(null),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alle impostazioni",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("div",{className:"w-10"})]})})}),e.jsx("main",{className:"flex-1 max-w-4xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-6 md:py-8 w-full",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ot,{className:"h-16 w-16 text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-cream mb-2",children:"ARCHIVIO VINI"}),e.jsx("p",{className:"text-gray-400",children:"Sezione in costruzione"})]})})]}):r==="suppliers"?e.jsxs("div",{className:"h-screen max-h-screen overflow-hidden flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:()=>a(null),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alle impostazioni",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:bg-gray-700 rounded-lg transition-colors",title:"Torna alla home",children:e.jsx($e,{className:"h-6 w-6"})})]})})}),e.jsxs("main",{className:"flex-1 flex flex-col max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 w-full overflow-hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-800/50 border border-gray-700 p-4 rounded-xl text-left transition-all duration-200 group hover:bg-gray-700/50 hover:border-gray-600 cursor-pointer",onClick:()=>n(!0),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-700/50 rounded-lg group-hover:bg-gray-600/50 transition-colors",children:e.jsx(st,{className:"h-4 w-4 text-gray-300"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"text-sm font-bold text-cream",children:"NUOVO FORNITORE"})}),e.jsx(ot,{className:"h-4 w-4 text-gray-500 group-hover:text-gray-400 transition-colors"})]})}),e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3",children:"Fornitori Attivi"}),d?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-600 border-t-amber-500 rounded-full animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Caricamento fornitori..."})]}):p?e.jsx("div",{className:"bg-red-500/20 border border-red-500/30 text-red-300 p-3 rounded-lg text-sm",children:p}):i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(st,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nessun fornitore attivo"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Aggiungi il tuo primo fornitore!"})]}):i.map(w=>e.jsx("div",{className:"bg-gray-800/30 border border-gray-700/50 p-3 rounded-lg text-left transition-all duration-200 group hover:bg-gray-700/30 hover:border-gray-600/50 cursor-pointer",onClick:()=>f(w),title:"Clicca per modificare le informazioni del fornitore",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 bg-gray-700/30 rounded-md",children:e.jsx(st,{className:"h-3.5 w-3.5 text-gray-400"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h5",{className:"text-sm font-medium text-cream uppercase",children:w.nome.toUpperCase()})})]})},w.id))]})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"text-gray-400",style:{fontSize:"8px"},children:[e.jsx("div",{className:"mb-1",children:"Versione: 1.0.0"}),e.jsxs("div",{children:["Ultimo aggiornamento: ",new Date().toLocaleDateString("it-IT")," -"," ",new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})]})]})})]}),e.jsx(Dr,{isOpen:s,onClose:()=>n(!1),onSupplierAdded:()=>{g(),n(!1)}}),e.jsx(Fr,{isOpen:o,onClose:()=>{c(!1),u(null)},onSupplierUpdated:()=>{g(),c(!1),u(null)},supplier:x})]}):r==="general"?e.jsxs("div",{className:"h-screen max-h-screen overflow-hidden flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between h-20",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:()=>a(null),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alle impostazioni",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("div",{className:"w-10"})]})})})}),e.jsxs("main",{className:"flex-1 flex flex-col max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full overflow-hidden",children:[e.jsxs("div",{className:"text-center py-12",children:[e.jsx(zr,{className:"h-16 w-16 text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-cream mb-2",children:"PREFERENZE"}),e.jsx("p",{className:"text-gray-400",children:"Sezione in costruzione"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mt-auto text-center",children:e.jsxs("div",{className:"text-gray-400",style:{fontSize:"8px"},children:[e.jsx("div",{className:"mb-1",children:"Versione: 1.0.0"}),e.jsxs("div",{children:["Ultimo aggiornamento: ",new Date().toLocaleDateString("it-IT")," -"," ",new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})]})]})})]})]}):e.jsxs("div",{className:"h-screen max-h-screen overflow-hidden flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between h-20",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alla home",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:text-cream hover:bg-gray-800 rounded-lg transition-colors",title:"Vai alla home",style:{filter:"brightness(1.2)",color:"#ffffff"},children:e.jsx($e,{className:"h-6 w-6"})})]})})})}),e.jsxs("main",{className:"flex-1 flex flex-col max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:j.map(w=>{const S=w.icon;return e.jsx("div",{className:"bg-gray-800/50 border border-gray-700 p-3 rounded-xl text-left transition-all duration-200 group hover:bg-gray-700/50 hover:border-gray-600 cursor-pointer",onClick:()=>{w.id==="account"?t("/settings/account"):w.id==="suppliers"?t("/settings/fornitori"):w.id==="database"?t("/settings/archivi"):w.id==="general"?t("/settings/preferenze"):a(w.id)},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-700/50 rounded-lg group-hover:bg-gray-600/50 transition-colors",children:e.jsx(S,{className:"h-4 w-4 text-gray-300"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"text-sm font-bold text-cream",children:w.title})}),e.jsx(ot,{className:"h-4 w-4 text-gray-500 group-hover:text-gray-400 transition-colors"})]})},w.id)})}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mt-auto text-center",children:e.jsxs("div",{className:"text-gray-400",style:{fontSize:"8px"},children:[e.jsx("div",{className:"mb-1",children:"Versione: 1.0.0"}),e.jsxs("div",{children:["Ultimo aggiornamento: ",new Date().toLocaleDateString("it-IT")," -"," ",new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})]})]})})]})]})}async function ln(t){return{success:!1,msg:"❌ Funzionalità AI disabilitata",importedWines:0,importedCategories:0,errors:["Funzione AI non disponibile"]}}function or(){const t=Oe(),[r,a]=l.useState(""),[s,n]=l.useState(!1),[o,c]=l.useState(!1),[x,u]=l.useState("idle"),[i,d]=l.useState(""),[p,g]=l.useState("");l.useEffect(()=>{j()},[]),l.useEffect(()=>{if(p){const S=setTimeout(()=>g(""),5e3);return()=>clearTimeout(S)}},[p]);const j=async()=>{const S=q.getUserId();if(!(!S||!ee||!R))try{const{data:C,error:k}=await R.from("impostazioni").select("google_sheet_url").eq("user_id",S).single();C&&C.google_sheet_url&&a(C.google_sheet_url)}catch(C){console.error("Error loading existing sheet link:",C)}},f=async()=>{const S=q.getUserId();if(!S||!r.trim()){u("error"),d("Inserisci un link valido al Google Sheet");return}if(!ee||!R){u("error"),d("Supabase non disponibile");return}c(!0),u("idle");try{const{data:C}=await R.from("impostazioni").select("id").eq("user_id",S).single();let k;if(C?k=await R.from("impostazioni").update({google_sheet_url:r.trim()}).eq("user_id",S):k=await R.from("impostazioni").insert({user_id:S,google_sheet_url:r.trim()}),k.error)throw k.error;u("success"),d("✅ Link Google Sheet salvato con successo!")}catch(C){console.error("Error saving sheet link:",C),u("error"),d("❌ Errore durante il salvataggio del link")}finally{c(!1)}},w=async()=>{if(!window.confirm(`ATTENZIONE
⚠️ Tutti i vini saranno sostituiti con quelli del Google Sheet.
Vuoi continuare?`)||!window.confirm(`⚠️ Azione definitiva.
Continuare?`))return;if(!q.getUserId()){u("error"),d("Utente non autenticato");return}if(!r.trim()){u("error"),d("Inserisci un link al Google Sheet");return}n(!0),u("idle"),g("");try{const N=await ln(r);N.success?(u("success"),d(`✅ Importazione completata - ${N.importedWines} vini importati`),g(N.msg),o||await f()):(u("error"),d(`❌ ${N.msg}`),g("")),N.errors&&N.errors.length>0&&console.warn("Avvisi durante l'importazione:",N.errors)}catch(N){console.error("Errore importazione Google Sheet:",N),u("error"),d("❌ Errore durante l'importazione"),g("")}finally{n(!1)}};return e.jsxs("div",{className:"min-h-screen text-white",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:()=>t("/settings/archivi"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alla pagina archivi",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:text-yellow-300 hover:bg-gray-800 rounded-lg transition-colors",title:"Vai alla home",children:e.jsx($e,{className:"h-6 w-6"})})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"max-w-xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center text-white mb-8 tracking-wide",children:"SYNCRO GOOGLE SHEET"}),e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsxs("a",{href:"https://docs.google.com/spreadsheets/d/1tRershHMvfmA8GHfhmzk5mts6CxLwBl7wH3Q0c9roSA/copy",target:"_blank",rel:"noopener noreferrer",className:"w-1/2 flex items-center justify-center gap-2 text-black font-semibold hover:opacity-90 transition-all duration-200 shadow-lg hover:shadow-xl",style:{borderRadius:"12px",padding:"12px 24px",fontSize:"14px",backgroundColor:"#e0b300",border:"2px solid #c9a100"},children:[e.jsx(Gs,{className:"w-4 h-4"}),"Scarica Google Sheet"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Link Google Sheet"}),e.jsx("input",{type:"url",value:r,onChange:S=>a(S.target.value),className:"w-full p-3 text-white bg-black/40 focus:outline-none focus:ring-2 focus:ring-red-500/50 rounded-lg placeholder-gray-600",placeholder:"incolla qui il link",disabled:s||o,required:!0})]}),x!=="idle"&&e.jsx("div",{className:"mb-6",children:x==="success"?e.jsx("div",{className:"p-3 rounded-lg border border-green-500 bg-green-500/10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-green-400"}),e.jsx("p",{className:"text-green-300 text-sm font-medium",children:i})]})}):e.jsx("div",{className:"p-3 rounded-lg border border-red-500 bg-red-500/10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:"text-red-300 text-sm font-medium",children:i})]})})}),p&&e.jsx("div",{className:"mb-6 p-3 rounded-lg border border-green-500 bg-green-500/10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-green-400"}),e.jsx("p",{className:"text-green-300 text-sm font-medium",children:p})]})}),e.jsx("div",{className:"flex items-center justify-center pt-2 mb-6",children:e.jsx("button",{onClick:w,disabled:s||!r.trim(),className:"w-1/2 flex items-center justify-center gap-2 text-white hover:opacity-90 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl",style:{borderRadius:"12px",padding:"12px 24px",fontWeight:"600",fontSize:"14px",backgroundColor:"#1B4D3E",border:"2px solid #0F5132",background:"linear-gradient(135deg, #1B4D3E 0%, #0F5132 100%)"},children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_r,{className:"w-4 h-4"}),"Importa ora"]})})}),e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"p-6 rounded-lg border border-white/10",style:{backgroundColor:"#1a0000"},children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-3",children:"💡 Come preparare il Google Sheet:"}),e.jsxs("ol",{className:"text-sm text-gray-400 space-y-2 list-decimal list-inside",children:[e.jsx("li",{children:"Crea tab separati chiamati: ROSSI, BIANCHI, BOLLICINE, ROSATI"}),e.jsx("li",{children:'In ogni tab, crea una colonna "NAME" con i nomi dei vini'}),e.jsx("li",{children:"Inserisci i vini (un vino per riga nella colonna NAME)"}),e.jsx("li",{children:'Clicca su "Condividi" → "Modifica le autorizzazioni di accesso"'}),e.jsx("li",{children:'Seleziona "Chiunque abbia il link può visualizzare"'}),e.jsx("li",{children:"Copia il link e incollalo qui sopra"})]})]})})]})})]})}function gt({onLoginSuccess:t}){const[r,a]=l.useState(""),[s,n]=l.useState(""),[o,c]=l.useState(!1),[x,u]=l.useState(!0),[i,d]=l.useState(!1),[p,g]=l.useState(null),j=async f=>{f.preventDefault(),d(!0),g(null);try{x?await q.signIn(r,s):await q.signUp(r,s),t==null||t()}catch(w){g(w.message??"Errore durante l'autenticazione")}finally{d(!1)}};return e.jsx("div",{className:"h-screen flex items-center justify-center p-3 overflow-hidden",style:{backgroundColor:"#2c0405"},children:e.jsxs("div",{className:"rounded-lg p-6 w-full max-w-xs shadow-xl",style:{backgroundColor:"#24161d",border:"1px solid #374151"},children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("img",{src:"/logo 1 CCV.png",alt:"Logo",className:"h-44 w-44 object-contain mx-auto"})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-xs font-medium text-cream mb-1",children:"EMAIL"}),e.jsx("input",{type:"email",id:"email",value:r,onChange:f=>a(f.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 text-cream rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all text-sm",placeholder:"inserisci la tua email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-xs font-medium text-cream mb-1",children:"PASSWORD"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",id:"password",value:s,onChange:f=>n(f.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 text-cream rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all pr-10 text-sm",placeholder:"inserisci la password",required:!0}),e.jsx("button",{type:"button",onClick:()=>c(f=>!f),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-cream transition-colors","aria-label":o?"Nascondi password":"Mostra password",children:o?e.jsx(Js,{className:"h-4 w-4"}):e.jsx(Ys,{className:"h-4 w-4"})})]})]}),p&&e.jsx("div",{className:"bg-red-900/50 border border-red-500 text-red-200 px-3 py-2 rounded-md text-xs",children:p}),e.jsx("button",{type:"submit",disabled:i,className:"w-full bg-amber-700 hover:bg-amber-600 disabled:opacity-50 text-cream font-semibold py-2 px-3 rounded-md transition-colors duration-200 flex items-center justify-center gap-1 text-sm",children:i?e.jsx("div",{className:"w-4 h-4 border-2 border-cream border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[x?e.jsx(Zs,{className:"h-4 w-4"}):e.jsx(tn,{className:"h-4 w-4"}),x?"ACCEDI":"REGISTRATI"]})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>{u(f=>!f),g(null)},className:"text-amber-400 hover:text-amber-300 transition-colors text-xs",children:x?"Non hai un account? Registrati":"Hai già un account? Accedi"})})]})]})})}function ir(){const[t,r]=l.useState({assistantEdits:0,agentCheckpoints:0,totalCost:0,monthlyBudget:25,lastReset:new Date().toISOString().slice(0,7)});l.useEffect(()=>{const n=localStorage.getItem("replit-cost-tracker");n&&r(JSON.parse(n))},[]);const a=t.monthlyBudget-t.totalCost,s=t.totalCost/t.monthlyBudget*100;return e.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-sm p-6 rounded-xl border border-gray-700 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Hs,{className:"h-6 w-6 text-green-400"}),e.jsx("h2",{className:"text-xl font-bold text-cream",children:"💰 SALDO REPLIT"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Speso questo mese:"}),e.jsxs("span",{className:"text-2xl font-bold text-red-400",children:["$",t.totalCost.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Budget rimanente:"}),e.jsxs("span",{className:"text-2xl font-bold text-green-400",children:["$",a.toFixed(2)]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3 mt-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${s>90?"bg-red-500":s>70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(s,100)}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 text-sm",children:[e.jsxs("div",{className:"bg-gray-800 p-2 rounded",children:[e.jsx("div",{className:"text-gray-400",children:"Assistant Edits"}),e.jsx("div",{className:"text-blue-400 font-bold",children:t.assistantEdits})]}),e.jsxs("div",{className:"bg-gray-800 p-2 rounded",children:[e.jsx("div",{className:"text-gray-400",children:"Agent Checkpoints"}),e.jsx("div",{className:"text-purple-400 font-bold",children:t.agentCheckpoints})]})]}),s>90&&e.jsxs("div",{className:"flex items-center mt-3 p-2 bg-red-900/20 border border-red-700/30 rounded",children:[e.jsx(Lr,{className:"h-4 w-4 text-red-400 mr-2"}),e.jsx("span",{className:"text-sm text-red-400",children:"⚠️ Budget quasi esaurito!"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-3 text-center",children:["Reset automatico: ",new Date().toLocaleDateString("it-IT",{month:"long",year:"numeric"})]})]})]})}function cn(t){if(!t||typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",r.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}Array(12).fill(0);let Mt=1;class dn{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{const a=this.subscribers.indexOf(r);this.subscribers.splice(a,1)}),this.publish=r=>{this.subscribers.forEach(a=>a(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var a;const{message:s,...n}=r,o=typeof(r==null?void 0:r.id)=="number"||((a=r.id)==null?void 0:a.length)>0?r.id:Mt++,c=this.toasts.find(u=>u.id===o),x=r.dismissible===void 0?!0:r.dismissible;return this.dismissedToasts.has(o)&&this.dismissedToasts.delete(o),c?this.toasts=this.toasts.map(u=>u.id===o?(this.publish({...u,...r,id:o,title:s}),{...u,...r,id:o,dismissible:x,title:s}):u):this.addToast({title:s,...n,dismissible:x,id:o}),o},this.dismiss=r=>(r?(this.dismissedToasts.add(r),requestAnimationFrame(()=>this.subscribers.forEach(a=>a({id:r,dismiss:!0})))):this.toasts.forEach(a=>{this.subscribers.forEach(s=>s({id:a.id,dismiss:!0}))}),r),this.message=(r,a)=>this.create({...a,message:r}),this.error=(r,a)=>this.create({...a,message:r,type:"error"}),this.success=(r,a)=>this.create({...a,type:"success",message:r}),this.info=(r,a)=>this.create({...a,type:"info",message:r}),this.warning=(r,a)=>this.create({...a,type:"warning",message:r}),this.loading=(r,a)=>this.create({...a,type:"loading",message:r}),this.promise=(r,a)=>{if(!a)return;let s;a.loading!==void 0&&(s=this.create({...a,promise:r,type:"loading",message:a.loading,description:typeof a.description!="function"?a.description:void 0}));const n=Promise.resolve(r instanceof Function?r():r);let o=s!==void 0,c;const x=n.then(async i=>{if(c=["resolve",i],Ge.isValidElement(i))o=!1,this.create({id:s,type:"default",message:i});else if(mn(i)&&!i.ok){o=!1;const p=typeof a.error=="function"?await a.error(`HTTP error! status: ${i.status}`):a.error,g=typeof a.description=="function"?await a.description(`HTTP error! status: ${i.status}`):a.description,f=typeof p=="object"&&!Ge.isValidElement(p)?p:{message:p};this.create({id:s,type:"error",description:g,...f})}else if(i instanceof Error){o=!1;const p=typeof a.error=="function"?await a.error(i):a.error,g=typeof a.description=="function"?await a.description(i):a.description,f=typeof p=="object"&&!Ge.isValidElement(p)?p:{message:p};this.create({id:s,type:"error",description:g,...f})}else if(a.success!==void 0){o=!1;const p=typeof a.success=="function"?await a.success(i):a.success,g=typeof a.description=="function"?await a.description(i):a.description,f=typeof p=="object"&&!Ge.isValidElement(p)?p:{message:p};this.create({id:s,type:"success",description:g,...f})}}).catch(async i=>{if(c=["reject",i],a.error!==void 0){o=!1;const d=typeof a.error=="function"?await a.error(i):a.error,p=typeof a.description=="function"?await a.description(i):a.description,j=typeof d=="object"&&!Ge.isValidElement(d)?d:{message:d};this.create({id:s,type:"error",description:p,...j})}}).finally(()=>{o&&(this.dismiss(s),s=void 0),a.finally==null||a.finally.call(a)}),u=()=>new Promise((i,d)=>x.then(()=>c[0]==="reject"?d(c[1]):i(c[1])).catch(d));return typeof s!="string"&&typeof s!="number"?{unwrap:u}:Object.assign(s,{unwrap:u})},this.custom=(r,a)=>{const s=(a==null?void 0:a.id)||Mt++;return this.create({jsx:r(s),id:s,...a}),s},this.getActiveToasts=()=>this.toasts.filter(r=>!this.dismissedToasts.has(r.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Ae=new dn,un=(t,r)=>{const a=(r==null?void 0:r.id)||Mt++;return Ae.addToast({title:t,...r,id:a}),a},mn=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",hn=un,pn=()=>Ae.toasts,fn=()=>Ae.getActiveToasts(),Me=Object.assign(hn,{success:Ae.success,info:Ae.info,warning:Ae.warning,error:Ae.error,custom:Ae.custom,message:Ae.message,promise:Ae.promise,dismiss:Ae.dismiss,loading:Ae.loading},{getHistory:pn,getToasts:fn});cn("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function gn(){const[t,r]=l.useState(null);return l.useEffect(()=>{R.auth.getUser().then(({data:a})=>{r((a==null?void 0:a.user)??null)})},[]),t}function lr(){const t=Oe();gn();const{refreshWines:r}=Ht(),[a,s]=l.useState(""),[n,o]=l.useState(""),[c,x]=l.useState("2"),[u,i]=l.useState("0"),[d,p]=l.useState(""),[g,j]=l.useState(""),[f,w]=l.useState(0),[S,C]=l.useState(!1),[k,N]=l.useState(""),[z,F]=l.useState(!1),[X,B]=l.useState(!1),[h,m]=l.useState(!1),[y,v]=l.useState(null);function E(I){return I.replace(/[\u2028\r]/g,`
`).replace(/\n{2,}/g,`
`).split(`
`).map(A=>A.trim()).filter(A=>A!=="")}function T(){const I=E(g),$=I.join(`
`);j($),w(I.length);const A=document.getElementById("count-righe");A&&(A.textContent=`${I.length}`)}async function Z(){if(k.trim())try{const{data:I,error:$}=await R.auth.getUser();if($||!I.user)return Me.error("Devi essere loggato per aggiungere categorie.");const{error:A}=await R.from("categorie").insert({user_id:I.user.id,nome:k.trim(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()});A?(console.error(A),Me.error("Errore nell'aggiunta della categoria.")):(s(k.trim()),Me.success("Categoria aggiunta con successo!"),N(""),C(!1))}catch(I){console.error("Errore:",I),Me.error("Errore durante l'aggiunta della categoria.")}}function oe(I){if(!d||d===""){F(!0),setTimeout(()=>{F(!1)},5e3);return}v(I?"replace":"add"),m(!0)}async function be(I){var se;const $=((se=document.getElementById("elenco-vini"))==null?void 0:se.value)||g,A=E($);if(A.length===0)return Me.warning("Nessun vino da salvare.");try{const{data:M,error:W}=await R.auth.getUser();if(W||!M.user)return Me.error("Devi essere loggato per salvare.");const D=M.user.id;if(I){const{error:ae}=await R.from("giacenze").delete().eq("user_id",D).eq("type",a.toLowerCase());if(ae)return console.error(ae),Me.error("Errore nella cancellazione dei vini esistenti.")}const H=A.map(ae=>({name:ae,type:a.toLowerCase(),supplier:n||"Da definire",inventory:parseInt(u)||0,min_stock:parseInt(c)||2,price:0,vintage:null,region:null,description:null,user_id:D,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),{error:le}=await R.from("giacenze").insert(H);if(le)console.error(le),Me.error("Errore nel salvataggio dei vini.");else{B(!0),setTimeout(()=>{B(!1)},5e3),await r(),j(""),w(0),p(""),s(""),o("");const ae=document.getElementById("count-righe");ae&&(ae.textContent="0")}}catch(M){console.error("Errore generale:",M),Me.error("Errore durante il salvataggio.")}}return e.jsxs("div",{className:"min-h-screen text-white",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:()=>t("/settings/archivi"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alla pagina archivi",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:text-cream hover:bg-gray-800 rounded-lg transition-colors",title:"Vai alla home",style:{filter:"brightness(1.2)",color:"#ffffff"},children:e.jsx($e,{className:"h-6 w-6"})})]})})}),e.jsxs("div",{className:"max-w-xl mx-auto",style:{padding:"20px"},children:[e.jsx("h1",{className:"text-2xl font-bold text-center text-cream mb-6",children:"INSERISCI LISTA VINI"}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"text-sm text-gray-400 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Incolla qui dentro la lista vini e clicca qui"}),e.jsxs("button",{onClick:T,className:"text-yellow-500 hover:text-yellow-600 inline-flex items-center",title:"Ottimizza testo",children:[e.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",children:e.jsxs("g",{children:[e.jsx("path",{d:"M12 2L13.09 8.26L19 9L13.09 9.74L12 16L10.91 9.74L5 9L10.91 8.26L12 2Z",fill:"#FFD700",stroke:"#FFA500",strokeWidth:"0.5"}),e.jsx("path",{d:"M18 5L18.5 6.5L20 7L18.5 7.5L18 9L17.5 7.5L16 7L17.5 6.5L18 5Z",fill:"#FFD700"}),e.jsx("path",{d:"M6 18L6.5 19.5L8 20L6.5 20.5L6 22L5.5 20.5L4 20L5.5 19.5L6 18Z",fill:"#FFD700"})]})}),e.jsx("span",{className:"text-white font-bold",children:"AI"})]})]}),e.jsx("div",{id:"count-righe",className:"text-green-400 text-sm mr-4",children:f})]})}),e.jsx("div",{className:"relative mb-4",children:e.jsx("textarea",{id:"elenco-vini",rows:10,placeholder:"Es: Soave Classico DOC Inama, Veneto",className:"text-sm border border-[#4a2a2a]",style:{borderRadius:"12px",padding:"12px",backgroundColor:"rgba(50, 0, 0, 0.6)",color:"white",width:"100%"},value:g,onChange:I=>j(I.target.value)})}),e.jsxs("div",{className:"mb-4",children:[z&&e.jsx("div",{className:"mb-3 p-3 rounded-lg border border-yellow-500 bg-yellow-500/10",children:e.jsx("p",{className:"text-yellow-300 text-sm font-medium",children:"⚠️ Seleziona almeno una tipologia di vino prima di salvare la lista."})}),X&&e.jsx("div",{className:"mb-3 p-3 rounded-lg border border-green-500 bg-green-500/10",children:e.jsx("p",{className:"text-green-300 text-sm font-medium",children:"✅ Lista vini salvata con successo!"})}),e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Seleziona TIPOLOGIA vino (obbligatorio)"}),e.jsxs("div",{className:"flex items-center gap-3 p-2 border border-[#4a2a2a]",style:{borderRadius:"12px",backgroundColor:"rgba(50, 0, 0, 0.6)"},children:[e.jsxs("select",{className:"flex-1 bg-transparent text-white border-none outline-none",style:{padding:"8px 0",fontSize:"16px",appearance:"none",backgroundImage:`url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23ffffff" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>')`,backgroundRepeat:"no-repeat",backgroundPosition:"8px center",backgroundSize:"12px",paddingLeft:"30px"},value:d,onChange:I=>{const $=I.target.value;p($),console.log("🔄 Tipologia selezionata:",$)},children:[e.jsx("option",{value:"",style:{color:"#6b7280"},children:"seleziona..."}),e.jsx("option",{value:"Bianco",children:"Bianco"}),e.jsx("option",{value:"Rosso",children:"Rosso"}),e.jsx("option",{value:"Bollicine",children:"Bollicine"}),e.jsx("option",{value:"Rosato",children:"Rosato"}),e.jsx("option",{value:"Dolce",children:"Dolce"})]}),e.jsx("button",{onClick:()=>C(!0),className:"flex items-center justify-center text-white hover:bg-red-700 transition-colors border border-[#2c1b1b]",style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:"rgba(80, 0, 0, 0.9)",fontSize:"18px",fontWeight:"bold"},title:"Aggiungi categoria",children:"+"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"FORNITORE (opzionale)"}),e.jsx("div",{className:"flex items-center gap-3 p-2 border border-[#4a2a2a]",style:{borderRadius:"12px",backgroundColor:"rgba(50, 0, 0, 0.6)"},children:e.jsx("input",{type:"text",className:"flex-1 bg-transparent text-white border-none outline-none",style:{padding:"8px 0",fontSize:"16px",paddingLeft:"8px"},value:n,onChange:I=>o(I.target.value),placeholder:"Nome fornitore..."})})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Soglia Minima"}),e.jsx("input",{type:"number",value:c,onChange:I=>x(I.target.value),min:"0",className:"w-full p-3 border border-[#4a2a2a] text-white bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500",style:{borderRadius:"12px",backgroundColor:"rgba(50, 0, 0, 0.6)"},placeholder:"2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Giacenza"}),e.jsx("input",{type:"number",value:u,onChange:I=>i(I.target.value),min:"0",className:"w-full p-3 border border-[#4a2a2a] text-white bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500",style:{borderRadius:"12px",backgroundColor:"rgba(50, 0, 0, 0.6)"},placeholder:"0"})]})]}),e.jsxs("div",{className:"flex items-center pt-2 gap-3",children:[e.jsxs("button",{className:"flex items-center justify-center gap-2 text-white hover:opacity-90 transition-opacity",style:{borderRadius:"12px",padding:"14px 20px",fontWeight:"600",fontSize:"16px",flex:"1",backgroundColor:"#166534"},onClick:()=>oe(!1),children:[e.jsx(_r,{className:"w-4 h-4"}),"Aggiungi a lista esistente"]}),e.jsxs("button",{className:"flex items-center justify-center gap-2 text-white hover:bg-[#455a6b] transition-colors",style:{borderRadius:"12px",padding:"14px 20px",fontWeight:"600",fontSize:"16px",flex:"1",backgroundColor:"#526D82"},onClick:()=>oe(!0),children:[e.jsx(it,{className:"w-4 h-4"}),"Sostituisci lista esistente"]})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-cream",children:"Aggiungi Categoria"}),e.jsx("button",{onClick:()=>{C(!1),N("")},className:"text-gray-400 hover:text-cream",children:"×"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nome Categoria"}),e.jsx("input",{type:"text",value:k,onChange:I=>N(I.target.value),placeholder:"Es: Dessert, Champagne...",className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-cream focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{C(!1),N("")},className:"flex-1 bg-gray-700 hover:bg-gray-600 text-cream rounded px-4 py-2 transition-colors",children:"Annulla"}),e.jsx("button",{onClick:Z,disabled:!k.trim(),className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-cream rounded px-4 py-2 transition-colors",children:"Aggiungi"})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-cream",children:"Conferma Salvataggio"}),e.jsx("button",{onClick:()=>{m(!1),v(null)},className:"text-gray-400 hover:text-cream",children:"×"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-6",children:y==="replace"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-red-300 text-center font-semibold",children:"🚨 ATTENZIONE: Stai per SOSTITUIRE completamente la lista esistente!"}),e.jsxs("p",{className:"text-red-400 text-sm text-center mt-2",children:['Tutti i vini della categoria "',d,'" verranno eliminati e sostituiti con questa nuova lista.']}),e.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"Questa operazione NON può essere annullata. Sei sicuro di voler procedere?"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-300 text-center",children:"⚠️ Sei sicuro di voler salvare la lista vini?"}),e.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:'Premi "Conferma" per procedere, oppure "Annulla" per modificare.'})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{m(!1),v(null)},className:"flex-1 bg-gray-700 hover:bg-gray-600 text-cream rounded px-4 py-2 transition-colors",children:"Annulla"}),e.jsx("button",{onClick:()=>{m(!1),y==="add"?be(!1):y==="replace"&&be(!0),v(null)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-cream rounded px-4 py-2 transition-colors",children:"Conferma"})]})]})]})})]})}function xn(){const t=Oe(),[r,a]=l.useState(!1),[s,n]=l.useState(!1),[o,c]=l.useState(null),[x,u]=l.useState(!1),[i,d]=l.useState(!1),{suppliers:p,isLoading:g,error:j,refreshSuppliers:f}=Gt(),w=C=>{c(C),n(!0)},S=async()=>{if(!ee||!q.isAuthenticated()){alert("Errore di autenticazione");return}const C=q.getUserId();if(!C){alert("ID utente non disponibile");return}d(!0);try{const{error:k}=await R.from("fornitori").delete().eq("user_id",C);if(k)throw console.error("Errore nell'eliminazione fornitori:",k),k;console.log("Reset fornitori completato con successo"),f(),u(!1)}catch(k){console.error("Errore durante il reset fornitori:",k),alert("Errore durante il reset dei fornitori. Riprova.")}finally{d(!1)}};return e.jsxs("div",{className:"h-screen max-h-screen overflow-hidden flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:()=>t("/settings"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alle impostazioni",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:bg-gray-700 rounded-lg transition-colors",title:"Torna alla home",children:e.jsx($e,{className:"h-6 w-6"})})]})})}),e.jsxs("main",{className:"flex-1 flex flex-col max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 w-full overflow-hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-800/50 border border-gray-700 p-4 rounded-xl text-left transition-all duration-200 group hover:bg-gray-700/50 hover:border-gray-600 cursor-pointer",onClick:()=>a(!0),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-700/50 rounded-lg group-hover:bg-gray-600/50 transition-colors",children:e.jsx(qt,{className:"h-4 w-4 text-gray-300"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"text-sm font-bold text-cream",children:"NUOVO FORNITORE"})}),e.jsx(ot,{className:"h-4 w-4 text-gray-500 group-hover:text-gray-400 transition-colors"})]})}),p.length>0&&e.jsx("div",{className:"bg-red-800/30 border border-red-700/50 p-4 rounded-xl text-left transition-all duration-200 group hover:bg-red-700/30 hover:border-red-600/50 cursor-pointer",onClick:()=>u(!0),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-700/50 rounded-lg group-hover:bg-red-600/50 transition-colors",children:e.jsx(Tt,{className:"h-4 w-4 text-red-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-red-300",children:"RESET FORNITORI"}),e.jsx("p",{className:"text-xs text-red-400/70",children:"Elimina tutti i fornitori"})]}),e.jsx(ot,{className:"h-4 w-4 text-red-500 group-hover:text-red-400 transition-colors"})]})}),e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3",children:"Fornitori Attivi"}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-600 border-t-amber-500 rounded-full animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Caricamento fornitori..."})]}):j?e.jsx("div",{className:"bg-red-500/20 border border-red-500/30 text-red-300 p-3 rounded-lg text-sm",children:j}):p.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(st,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nessun fornitore attivo"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Aggiungi il tuo primo fornitore!"})]}):p.map(C=>e.jsx("div",{className:"bg-gray-800/30 border border-gray-700/50 p-3 rounded-lg text-left transition-all duration-200 group hover:bg-gray-700/30 hover:border-gray-600/50 cursor-pointer",onClick:()=>w(C),title:"Clicca per modificare le informazioni del fornitore",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 bg-gray-700/30 rounded-md",children:e.jsx(st,{className:"h-3.5 w-3.5 text-gray-400"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h5",{className:"text-sm font-medium text-cream uppercase",children:C.nome.toUpperCase()})}),e.jsx("div",{className:"p-1.5 text-gray-500 rounded-md",children:e.jsx(Ks,{className:"h-3.5 w-3.5"})})]})},C.id))]})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"text-gray-400",style:{fontSize:"8px"},children:[e.jsx("div",{className:"mb-1",children:"Versione: 1.0.0"}),e.jsxs("div",{children:["Ultimo aggiornamento: ",new Date().toLocaleDateString("it-IT")," -"," ",new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})]})]})})]}),e.jsx(Dr,{isOpen:r,onClose:()=>a(!1),onSupplierAdded:()=>{f(),a(!1)}}),e.jsx(Fr,{isOpen:s,onClose:()=>{n(!1),c(null)},onSupplierUpdated:()=>{f(),n(!1),c(null)},supplier:o}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg max-w-md w-full p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-700/20 rounded-lg",children:e.jsx(Tt,{className:"h-5 w-5 text-red-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Conferma Reset Fornitori"})]}),e.jsxs("p",{className:"text-gray-300 mb-6",children:["Sei sicuro di voler eliminare ",e.jsx("strong",{children:"tutti i fornitori"}),"? Questa operazione non può essere annullata."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>u(!1),disabled:i,className:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg transition-colors disabled:opacity-50",children:"Annulla"}),e.jsx("button",{onClick:S,disabled:i,className:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Eliminazione..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Tt,{className:"h-4 w-4"}),"Elimina Tutto"]})})]})]})})]})}function bn(){const[t,r]=l.useState([]),[a,s]=l.useState(!1),n=async()=>{try{if(s(!0),!await q.validateSession()){console.log("⚠️ Sessione non valida, tipologie vuote"),r([]),s(!1);return}const i=q.getUserId();if(!i){console.log("⚠️ Utente non autenticato, tipologie vuote"),r([]),s(!1);return}console.log("🔍 Caricamento tipologie per user:",i);let{data:d,error:p}=await R.from("tipologie").select("id, nome, colore").eq("user_id",i).order("nome");if(p&&p.message.includes("column tipologie.colore does not exist")){console.log("⚠️ Colonna colore non presente, caricamento senza colore");const g=await R.from("tipologie").select("id, nome").eq("user_id",i).order("nome");d=g.data,p=g.error,d&&(d=d.map(j=>({...j,colore:"#cccccc"})))}if(p)console.error("❌ Errore caricamento tipologie:",p.message),console.error("❌ Dettagli errore:",p),r([]);else if(console.log("✅ Tipologie ricevute da Supabase:",d),d){const g=d.map(j=>({id:j.id,nome:j.nome,colore:j.colore||"#cccccc"}));r(g),console.log("✅ Tipologie mappate:",g.length)}}catch(u){console.error("❌ Errore nel caricamento tipologie:",u),r([])}finally{s(!1)}},o=async(u,i="#cccccc")=>{try{const{data:d,error:p}=await R.auth.getUser();if(p)return console.error("❌ Errore nel recupero utente:",p.message),!1;if(!d.user)return console.error("❌ Utente non autenticato"),!1;const g=d.user.id,{data:j,error:f}=await R.from("tipologie").select("id, nome").eq("user_id",g).ilike("nome",u.trim());if(f)return console.error("❌ Errore nel controllo duplicati:",f.message),!1;if(j&&j.length>0)return console.log("⚠️ Tipologia già esistente su Supabase:",u),!1;let{data:w,error:S}=await R.from("tipologie").insert({user_id:g,nome:u.trim().toUpperCase(),colore:i}).select().single();if(S&&S.message.includes('column "colore" of relation "tipologie" does not exist')){const C=await R.from("tipologie").insert({user_id:g,nome:u.trim().toUpperCase()}).select().single();w=C.data,S=C.error,w&&(w={...w,colore:"#cccccc"})}return S?(console.error("❌ Errore inserimento tipologia:",S.message),console.error("❌ Dettagli errore:",S),!1):(console.log("✅ Tipologia aggiunta con successo:",w),await n(),!0)}catch(d){return console.error("❌ Errore nell'aggiunta della tipologia:",d),!1}},c=async u=>{try{const{error:i}=await R.from("tipologie").delete().eq("id",u);return i?(console.error("❌ Errore nella rimozione della tipologia:",i.message),!1):(await n(),!0)}catch(i){return console.error("❌ Errore nella rimozione della tipologia:",i),!1}},x=async(u,i,d)=>{try{if(await n(),t.some(S=>S.id!==u&&S.nome.toLowerCase()===i.toLowerCase()))return!1;const{data:g,error:j}=await R.from("tipologie").select("id").ilike("nome",i.trim()).neq("id",u).limit(1);if(j)return console.error("❌ Errore nel controllo duplicati:",j.message),!1;if(g&&g.length>0)return!1;const f={nome:i.trim()};d!==void 0&&(f.colore=d);let{error:w}=await R.from("tipologie").update(f).eq("id",u);return w&&w.message.includes('column "colore" of relation "tipologie" does not exist')&&(w=(await R.from("tipologie").update({nome:i.trim()}).eq("id",u)).error),w?(console.error("❌ Errore aggiornamento tipologia:",w.message),!1):(await n(),!0)}catch(p){return console.error("❌ Errore nell'aggiornamento della tipologia:",p),!1}};return l.useEffect(()=>{s(!1)},[]),{tipologie:t,loading:a,addTipologia:o,removeTipologia:c,updateTipologia:x,refreshTipologie:n}}var Pr={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(t,r){((a,s)=>{t.exports=s()})(Xr,function a(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},n,o=!s.document&&!!s.postMessage,c=s.IS_PAPA_WORKER||!1,x={},u=0,i={};function d(h){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(m){var y=F(m);y.chunkSize=parseInt(y.chunkSize),m.step||m.chunk||(y.chunkSize=null),this._handle=new w(y),(this._handle.streamer=this)._config=y}).call(this,h),this.parseChunk=function(m,y){var v=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<v){let T=this._config.newline;T||(E=this._config.quoteChar||'"',T=this._handle.guessLineEndings(m,E)),m=[...m.split(T).slice(v)].join(T)}this.isFirstChunk&&B(this._config.beforeFirstChunk)&&(E=this._config.beforeFirstChunk(m))!==void 0&&(m=E),this.isFirstChunk=!1,this._halted=!1;var v=this._partialLine+m,E=(this._partialLine="",this._handle.parse(v,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(m=E.meta.cursor,v=(this._finished||(this._partialLine=v.substring(m-this._baseIndex),this._baseIndex=m),E&&E.data&&(this._rowCount+=E.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),c)s.postMessage({results:E,workerId:i.WORKER_ID,finished:v});else if(B(this._config.chunk)&&!y){if(this._config.chunk(E,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=E=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(E.data),this._completeResults.errors=this._completeResults.errors.concat(E.errors),this._completeResults.meta=E.meta),this._completed||!v||!B(this._config.complete)||E&&E.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),v||E&&E.meta.paused||this._nextChunk(),E}this._halted=!0},this._sendError=function(m){B(this._config.error)?this._config.error(m):c&&this._config.error&&s.postMessage({workerId:i.WORKER_ID,error:m,finished:!1})}}function p(h){var m;(h=h||{}).chunkSize||(h.chunkSize=i.RemoteChunkSize),d.call(this,h),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(y){this._input=y,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(m=new XMLHttpRequest,this._config.withCredentials&&(m.withCredentials=this._config.withCredentials),o||(m.onload=X(this._chunkLoaded,this),m.onerror=X(this._chunkError,this)),m.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var y,v=this._config.downloadRequestHeaders;for(y in v)m.setRequestHeader(y,v[y])}var E;this._config.chunkSize&&(E=this._start+this._config.chunkSize-1,m.setRequestHeader("Range","bytes="+this._start+"-"+E));try{m.send(this._config.downloadRequestBody)}catch(T){this._chunkError(T.message)}o&&m.status===0&&this._chunkError()}},this._chunkLoaded=function(){m.readyState===4&&(m.status<200||400<=m.status?this._chunkError():(this._start+=this._config.chunkSize||m.responseText.length,this._finished=!this._config.chunkSize||this._start>=(y=>(y=y.getResponseHeader("Content-Range"))!==null?parseInt(y.substring(y.lastIndexOf("/")+1)):-1)(m),this.parseChunk(m.responseText)))},this._chunkError=function(y){y=m.statusText||y,this._sendError(new Error(y))}}function g(h){(h=h||{}).chunkSize||(h.chunkSize=i.LocalChunkSize),d.call(this,h);var m,y,v=typeof FileReader<"u";this.stream=function(E){this._input=E,y=E.slice||E.webkitSlice||E.mozSlice,v?((m=new FileReader).onload=X(this._chunkLoaded,this),m.onerror=X(this._chunkError,this)):m=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var E=this._input,T=(this._config.chunkSize&&(T=Math.min(this._start+this._config.chunkSize,this._input.size),E=y.call(E,this._start,T)),m.readAsText(E,this._config.encoding));v||this._chunkLoaded({target:{result:T}})},this._chunkLoaded=function(E){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(E.target.result)},this._chunkError=function(){this._sendError(m.error)}}function j(h){var m;d.call(this,h=h||{}),this.stream=function(y){return m=y,this._nextChunk()},this._nextChunk=function(){var y,v;if(!this._finished)return y=this._config.chunkSize,m=y?(v=m.substring(0,y),m.substring(y)):(v=m,""),this._finished=!m,this.parseChunk(v)}}function f(h){d.call(this,h=h||{});var m=[],y=!0,v=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(E){this._input=E,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){v&&m.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),m.length?this.parseChunk(m.shift()):y=!0},this._streamData=X(function(E){try{m.push(typeof E=="string"?E:E.toString(this._config.encoding)),y&&(y=!1,this._checkIsFinished(),this.parseChunk(m.shift()))}catch(T){this._streamError(T)}},this),this._streamError=X(function(E){this._streamCleanUp(),this._sendError(E)},this),this._streamEnd=X(function(){this._streamCleanUp(),v=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function w(h){var m,y,v,E,T=Math.pow(2,53),Z=-T,oe=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,be=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,I=this,$=0,A=0,se=!1,M=!1,W=[],D={data:[],errors:[],meta:{}};function H(G){return h.skipEmptyLines==="greedy"?G.join("").trim()==="":G.length===1&&G[0].length===0}function le(){if(D&&v&&(Ce("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),v=!1),h.skipEmptyLines&&(D.data=D.data.filter(function(U){return!H(U)})),ae()){let U=function(de,ge){B(h.transformHeader)&&(de=h.transformHeader(de,ge)),W.push(de)};if(D)if(Array.isArray(D.data[0])){for(var G=0;ae()&&G<D.data.length;G++)D.data[G].forEach(U);D.data.splice(0,1)}else D.data.forEach(U)}function K(U,de){for(var ge=h.header?{}:[],P=0;P<U.length;P++){var te=P,Y=U[P],Y=((Se,V)=>(ue=>(h.dynamicTypingFunction&&h.dynamicTyping[ue]===void 0&&(h.dynamicTyping[ue]=h.dynamicTypingFunction(ue)),(h.dynamicTyping[ue]||h.dynamicTyping)===!0))(Se)?V==="true"||V==="TRUE"||V!=="false"&&V!=="FALSE"&&((ue=>{if(oe.test(ue)&&(ue=parseFloat(ue),Z<ue&&ue<T))return 1})(V)?parseFloat(V):be.test(V)?new Date(V):V===""?null:V):V)(te=h.header?P>=W.length?"__parsed_extra":W[P]:te,Y=h.transform?h.transform(Y,te):Y);te==="__parsed_extra"?(ge[te]=ge[te]||[],ge[te].push(Y)):ge[te]=Y}return h.header&&(P>W.length?Ce("FieldMismatch","TooManyFields","Too many fields: expected "+W.length+" fields but parsed "+P,A+de):P<W.length&&Ce("FieldMismatch","TooFewFields","Too few fields: expected "+W.length+" fields but parsed "+P,A+de)),ge}var ce;D&&(h.header||h.dynamicTyping||h.transform)&&(ce=1,!D.data.length||Array.isArray(D.data[0])?(D.data=D.data.map(K),ce=D.data.length):D.data=K(D.data,0),h.header&&D.meta&&(D.meta.fields=W),A+=ce)}function ae(){return h.header&&W.length===0}function Ce(G,K,ce,U){G={type:G,code:K,message:ce},U!==void 0&&(G.row=U),D.errors.push(G)}B(h.step)&&(E=h.step,h.step=function(G){D=G,ae()?le():(le(),D.data.length!==0&&($+=G.data.length,h.preview&&$>h.preview?y.abort():(D.data=D.data[0],E(D,I))))}),this.parse=function(G,K,ce){var U=h.quoteChar||'"',U=(h.newline||(h.newline=this.guessLineEndings(G,U)),v=!1,h.delimiter?B(h.delimiter)&&(h.delimiter=h.delimiter(G),D.meta.delimiter=h.delimiter):((U=((de,ge,P,te,Y)=>{var Se,V,ue,J;Y=Y||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var Re=0;Re<Y.length;Re++){for(var we,Ue=Y[Re],ye=0,je=0,xe=0,Ne=(ue=void 0,new C({comments:te,delimiter:Ue,newline:ge,preview:10}).parse(de)),Ee=0;Ee<Ne.data.length;Ee++)P&&H(Ne.data[Ee])?xe++:(we=Ne.data[Ee].length,je+=we,ue===void 0?ue=we:0<we&&(ye+=Math.abs(we-ue),ue=we));0<Ne.data.length&&(je/=Ne.data.length-xe),(V===void 0||ye<=V)&&(J===void 0||J<je)&&1.99<je&&(V=ye,Se=Ue,J=je)}return{successful:!!(h.delimiter=Se),bestDelimiter:Se}})(G,h.newline,h.skipEmptyLines,h.comments,h.delimitersToGuess)).successful?h.delimiter=U.bestDelimiter:(v=!0,h.delimiter=i.DefaultDelimiter),D.meta.delimiter=h.delimiter),F(h));return h.preview&&h.header&&U.preview++,m=G,y=new C(U),D=y.parse(m,K,ce),le(),se?{meta:{paused:!0}}:D||{meta:{paused:!1}}},this.paused=function(){return se},this.pause=function(){se=!0,y.abort(),m=B(h.chunk)?"":m.substring(y.getCharIndex())},this.resume=function(){I.streamer._halted?(se=!1,I.streamer.parseChunk(m,!0)):setTimeout(I.resume,3)},this.aborted=function(){return M},this.abort=function(){M=!0,y.abort(),D.meta.aborted=!0,B(h.complete)&&h.complete(D),m=""},this.guessLineEndings=function(de,U){de=de.substring(0,1048576);var U=new RegExp(S(U)+"([^]*?)"+S(U),"gm"),ce=(de=de.replace(U,"")).split("\r"),U=de.split(`
`),de=1<U.length&&U[0].length<ce[0].length;if(ce.length===1||de)return`
`;for(var ge=0,P=0;P<ce.length;P++)ce[P][0]===`
`&&ge++;return ge>=ce.length/2?`\r
`:"\r"}}function S(h){return h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function C(h){var m=(h=h||{}).delimiter,y=h.newline,v=h.comments,E=h.step,T=h.preview,Z=h.fastMode,oe=null,be=!1,I=h.quoteChar==null?'"':h.quoteChar,$=I;if(h.escapeChar!==void 0&&($=h.escapeChar),(typeof m!="string"||-1<i.BAD_DELIMITERS.indexOf(m))&&(m=","),v===m)throw new Error("Comment character same as delimiter");v===!0?v="#":(typeof v!="string"||-1<i.BAD_DELIMITERS.indexOf(v))&&(v=!1),y!==`
`&&y!=="\r"&&y!==`\r
`&&(y=`
`);var A=0,se=!1;this.parse=function(M,W,D){if(typeof M!="string")throw new Error("Input must be a string");var H=M.length,le=m.length,ae=y.length,Ce=v.length,G=B(E),K=[],ce=[],U=[],de=A=0;if(!M)return ye();if(Z||Z!==!1&&M.indexOf(I)===-1){for(var ge=M.split(y),P=0;P<ge.length;P++){if(U=ge[P],A+=U.length,P!==ge.length-1)A+=y.length;else if(D)return ye();if(!v||U.substring(0,Ce)!==v){if(G){if(K=[],J(U.split(m)),je(),se)return ye()}else J(U.split(m));if(T&&T<=P)return K=K.slice(0,T),ye(!0)}}return ye()}for(var te=M.indexOf(m,A),Y=M.indexOf(y,A),Se=new RegExp(S($)+S(I),"g"),V=M.indexOf(I,A);;)if(M[A]===I)for(V=A,A++;;){if((V=M.indexOf(I,V+1))===-1)return D||ce.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:K.length,index:A}),we();if(V===H-1)return we(M.substring(A,V).replace(Se,I));if(I===$&&M[V+1]===$)V++;else if(I===$||V===0||M[V-1]!==$){te!==-1&&te<V+1&&(te=M.indexOf(m,V+1));var ue=Re((Y=Y!==-1&&Y<V+1?M.indexOf(y,V+1):Y)===-1?te:Math.min(te,Y));if(M.substr(V+1+ue,le)===m){U.push(M.substring(A,V).replace(Se,I)),M[A=V+1+ue+le]!==I&&(V=M.indexOf(I,A)),te=M.indexOf(m,A),Y=M.indexOf(y,A);break}if(ue=Re(Y),M.substring(V+1+ue,V+1+ue+ae)===y){if(U.push(M.substring(A,V).replace(Se,I)),Ue(V+1+ue+ae),te=M.indexOf(m,A),V=M.indexOf(I,A),G&&(je(),se))return ye();if(T&&K.length>=T)return ye(!0);break}ce.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:K.length,index:A}),V++}}else if(v&&U.length===0&&M.substring(A,A+Ce)===v){if(Y===-1)return ye();A=Y+ae,Y=M.indexOf(y,A),te=M.indexOf(m,A)}else if(te!==-1&&(te<Y||Y===-1))U.push(M.substring(A,te)),A=te+le,te=M.indexOf(m,A);else{if(Y===-1)break;if(U.push(M.substring(A,Y)),Ue(Y+ae),G&&(je(),se))return ye();if(T&&K.length>=T)return ye(!0)}return we();function J(xe){K.push(xe),de=A}function Re(xe){var Ne=0;return Ne=xe!==-1&&(xe=M.substring(V+1,xe))&&xe.trim()===""?xe.length:Ne}function we(xe){return D||(xe===void 0&&(xe=M.substring(A)),U.push(xe),A=H,J(U),G&&je()),ye()}function Ue(xe){A=xe,J(U),U=[],Y=M.indexOf(y,A)}function ye(xe){if(h.header&&!W&&K.length&&!be){var Ne=K[0],Ee=Object.create(null),He=new Set(Ne);let mt=!1;for(let Be=0;Be<Ne.length;Be++){let Te=Ne[Be];if(Ee[Te=B(h.transformHeader)?h.transformHeader(Te,Be):Te]){let We,ht=Ee[Te];for(;We=Te+"_"+ht,ht++,He.has(We););He.add(We),Ne[Be]=We,Ee[Te]++,mt=!0,(oe=oe===null?{}:oe)[We]=Te}else Ee[Te]=1,Ne[Be]=Te;He.add(Te)}mt&&console.warn("Duplicate headers found and renamed."),be=!0}return{data:K,errors:ce,meta:{delimiter:m,linebreak:y,aborted:se,truncated:!!xe,cursor:de+(W||0),renamedHeaders:oe}}}function je(){E(ye()),K=[],ce=[]}},this.abort=function(){se=!0},this.getCharIndex=function(){return A}}function k(h){var m=h.data,y=x[m.workerId],v=!1;if(m.error)y.userError(m.error,m.file);else if(m.results&&m.results.data){var E={abort:function(){v=!0,N(m.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:z,resume:z};if(B(y.userStep)){for(var T=0;T<m.results.data.length&&(y.userStep({data:m.results.data[T],errors:m.results.errors,meta:m.results.meta},E),!v);T++);delete m.results}else B(y.userChunk)&&(y.userChunk(m.results,E,m.file),delete m.results)}m.finished&&!v&&N(m.workerId,m.results)}function N(h,m){var y=x[h];B(y.userComplete)&&y.userComplete(m),y.terminate(),delete x[h]}function z(){throw new Error("Not implemented.")}function F(h){if(typeof h!="object"||h===null)return h;var m,y=Array.isArray(h)?[]:{};for(m in h)y[m]=F(h[m]);return y}function X(h,m){return function(){h.apply(m,arguments)}}function B(h){return typeof h=="function"}return i.parse=function(h,m){var y=(m=m||{}).dynamicTyping||!1;if(B(y)&&(m.dynamicTypingFunction=y,y={}),m.dynamicTyping=y,m.transform=!!B(m.transform)&&m.transform,!m.worker||!i.WORKERS_SUPPORTED)return y=null,i.NODE_STREAM_INPUT,typeof h=="string"?(h=(v=>v.charCodeAt(0)!==65279?v:v.slice(1))(h),y=new(m.download?p:j)(m)):h.readable===!0&&B(h.read)&&B(h.on)?y=new f(m):(s.File&&h instanceof File||h instanceof Object)&&(y=new g(m)),y.stream(h);(y=(()=>{var v;return!!i.WORKERS_SUPPORTED&&(v=(()=>{var E=s.URL||s.webkitURL||null,T=a.toString();return i.BLOB_URL||(i.BLOB_URL=E.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",T,")();"],{type:"text/javascript"})))})(),(v=new s.Worker(v)).onmessage=k,v.id=u++,x[v.id]=v)})()).userStep=m.step,y.userChunk=m.chunk,y.userComplete=m.complete,y.userError=m.error,m.step=B(m.step),m.chunk=B(m.chunk),m.complete=B(m.complete),m.error=B(m.error),delete m.worker,y.postMessage({input:h,config:m,workerId:y.id})},i.unparse=function(h,m){var y=!1,v=!0,E=",",T=`\r
`,Z='"',oe=Z+Z,be=!1,I=null,$=!1,A=((()=>{if(typeof m=="object"){if(typeof m.delimiter!="string"||i.BAD_DELIMITERS.filter(function(W){return m.delimiter.indexOf(W)!==-1}).length||(E=m.delimiter),typeof m.quotes!="boolean"&&typeof m.quotes!="function"&&!Array.isArray(m.quotes)||(y=m.quotes),typeof m.skipEmptyLines!="boolean"&&typeof m.skipEmptyLines!="string"||(be=m.skipEmptyLines),typeof m.newline=="string"&&(T=m.newline),typeof m.quoteChar=="string"&&(Z=m.quoteChar),typeof m.header=="boolean"&&(v=m.header),Array.isArray(m.columns)){if(m.columns.length===0)throw new Error("Option columns is empty");I=m.columns}m.escapeChar!==void 0&&(oe=m.escapeChar+Z),m.escapeFormulae instanceof RegExp?$=m.escapeFormulae:typeof m.escapeFormulae=="boolean"&&m.escapeFormulae&&($=/^[=+\-@\t\r].*$/)}})(),new RegExp(S(Z),"g"));if(typeof h=="string"&&(h=JSON.parse(h)),Array.isArray(h)){if(!h.length||Array.isArray(h[0]))return se(null,h,be);if(typeof h[0]=="object")return se(I||Object.keys(h[0]),h,be)}else if(typeof h=="object")return typeof h.data=="string"&&(h.data=JSON.parse(h.data)),Array.isArray(h.data)&&(h.fields||(h.fields=h.meta&&h.meta.fields||I),h.fields||(h.fields=Array.isArray(h.data[0])?h.fields:typeof h.data[0]=="object"?Object.keys(h.data[0]):[]),Array.isArray(h.data[0])||typeof h.data[0]=="object"||(h.data=[h.data])),se(h.fields||[],h.data||[],be);throw new Error("Unable to serialize unrecognized input");function se(W,D,H){var le="",ae=(typeof W=="string"&&(W=JSON.parse(W)),typeof D=="string"&&(D=JSON.parse(D)),Array.isArray(W)&&0<W.length),Ce=!Array.isArray(D[0]);if(ae&&v){for(var G=0;G<W.length;G++)0<G&&(le+=E),le+=M(W[G],G);0<D.length&&(le+=T)}for(var K=0;K<D.length;K++){var ce=(ae?W:D[K]).length,U=!1,de=ae?Object.keys(D[K]).length===0:D[K].length===0;if(H&&!ae&&(U=H==="greedy"?D[K].join("").trim()==="":D[K].length===1&&D[K][0].length===0),H==="greedy"&&ae){for(var ge=[],P=0;P<ce;P++){var te=Ce?W[P]:P;ge.push(D[K][te])}U=ge.join("").trim()===""}if(!U){for(var Y=0;Y<ce;Y++){0<Y&&!de&&(le+=E);var Se=ae&&Ce?W[Y]:Y;le+=M(D[K][Se],Y)}K<D.length-1&&(!H||0<ce&&!de)&&(le+=T)}}return le}function M(W,D){var H,le;return W==null?"":W.constructor===Date?JSON.stringify(W).slice(1,25):(le=!1,$&&typeof W=="string"&&$.test(W)&&(W="'"+W,le=!0),H=W.toString().replace(A,oe),(le=le||y===!0||typeof y=="function"&&y(W,D)||Array.isArray(y)&&y[D]||((ae,Ce)=>{for(var G=0;G<Ce.length;G++)if(-1<ae.indexOf(Ce[G]))return!0;return!1})(H,i.BAD_DELIMITERS)||-1<H.indexOf(E)||H.charAt(0)===" "||H.charAt(H.length-1)===" ")?Z+H+Z:H)}},i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="\uFEFF",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!o&&!!s.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=C,i.ParserHandle=w,i.NetworkStreamer=p,i.FileStreamer=g,i.StringStreamer=j,i.ReadableStreamStreamer=f,s.jQuery&&((n=s.jQuery).fn.parse=function(h){var m=h.config||{},y=[];return this.each(function(T){if(!(n(this).prop("tagName").toUpperCase()==="INPUT"&&n(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var Z=0;Z<this.files.length;Z++)y.push({file:this.files[Z],inputElem:this,instanceConfig:n.extend({},m)})}),v(),this;function v(){if(y.length===0)B(h.complete)&&h.complete();else{var T,Z,oe,be,I=y[0];if(B(h.before)){var $=h.before(I.file,I.inputElem);if(typeof $=="object"){if($.action==="abort")return T="AbortError",Z=I.file,oe=I.inputElem,be=$.reason,void(B(h.error)&&h.error({name:T},Z,oe,be));if($.action==="skip")return void E();typeof $.config=="object"&&(I.instanceConfig=n.extend(I.instanceConfig,$.config))}else if($==="skip")return void E()}var A=I.instanceConfig.complete;I.instanceConfig.complete=function(se){B(A)&&A(se,I.file,I.inputElem),E()},i.parse(I.file,I.instanceConfig)}}function E(){y.splice(0,1),v()}}),c&&(s.onmessage=function(h){h=h.data,i.WORKER_ID===void 0&&h&&(i.WORKER_ID=h.workerId),typeof h.input=="string"?s.postMessage({workerId:i.WORKER_ID,results:i.parse(h.input,h.config),finished:!0}):(s.File&&h.input instanceof File||h.input instanceof Object)&&(h=i.parse(h.input,h.config))&&s.postMessage({workerId:i.WORKER_ID,results:h,finished:!0})}),(p.prototype=Object.create(d.prototype)).constructor=p,(g.prototype=Object.create(d.prototype)).constructor=g,(j.prototype=Object.create(j.prototype)).constructor=j,(f.prototype=Object.create(d.prototype)).constructor=f,i})})(Pr);var yn=Pr.exports;const cr=Zr(yn);function vn({}){const[t,r]=l.useState(!1),[a,s]=l.useState("idle"),[n,o]=l.useState("");l.useState("");const[c,x]=l.useState(!1),[u,i]=l.useState(!1),[d,p]=l.useState(""),[g,j]=l.useState(null),[f,w]=l.useState(!1),[S,C]=l.useState("idle"),[k,N]=l.useState("");l.useEffect(()=>{(async()=>{const v=q.getUserId();if(!(!v||!ee))try{const{data:E,error:T}=await R.from("user_settings").select("google_sheet_url").eq("user_id",v).single();!T&&(E!=null&&E.google_sheet_url)&&j(E.google_sheet_url)}catch(E){console.error("Error loading sheet link:",E)}})()},[]);const z=async(y,v,E)=>{if(!ee||!R)throw new Error("Supabase non disponibile");const{data:T,error:Z}=await R.from("giacenze").insert({name:y.trim(),type:v.toLowerCase().trim(),supplier:"-",inventory:0,min_stock:0,price:0,vintage:null,region:null,description:null,user_id:E,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(Z)throw console.error("Errore Supabase:",Z),Z;return T},F=async()=>{w(!1),C("error"),N("❌ Funzionalità AI disabilitata")},X=async()=>{const y=q.getUserId();if(!(!y||!ee))try{const{error:v}=await R.from("user_settings").delete().eq("user_id",y);v||(j(null),C("success"),N("✅ Link eliminato con successo"))}catch(v){console.error("Error deleting sheet link:",v)}},B=()=>{g&&(p(g),j(null))},h=async(y,v)=>{const E=q.getUserId();if(!E){s("error"),o("Utente non autenticato");return}if(!ee){s("error"),o("Supabase non configurato");return}r(!0),s("idle");try{const T=y.split(`
`).filter(I=>I.trim());if(T.length===0)throw new Error("Nessun dato da importare");let Z=0;const oe=[];for(let I=0;I<T.length;I++){const $=T[I].trim();if($)try{let A="",se="";if($.includes(",")){const M=$.split(",").map(W=>W.replace(/"/g,"").trim());if(M.length>=2)A=M[0],se=M[1].toLowerCase();else{oe.push(`Riga ${I+1}: Formato CSV non valido - deve contenere almeno nome,tipo`);continue}}else{const M=$.indexOf(" ");if(M===-1){oe.push(`Riga ${I+1}: Formato non valido - deve contenere nome e tipo separati da spazio`);continue}A=$.substring(0,M).trim(),se=$.substring(M+1).trim().toLowerCase()}if(!A||!se){oe.push(`Riga ${I+1}: Nome o tipo mancante`);continue}if(!["rosso","bianco","bollicine","rosato"].includes(se)){oe.push(`Riga ${I+1}: Tipo non valido - deve essere rosso, bianco, bollicine o rosato`);continue}await z(A,se,E),Z++}catch(A){console.error(`Errore riga ${I+1}:`,A),oe.push(`Riga ${I+1}: ${A instanceof Error?A.message:"Errore sconosciuto"}`)}}s("success");let be=`${v} importato con successo - ${Z} vini elaborati`;oe.length>0&&(be+=` (${oe.length} errori)`),o(be)}catch(T){console.error("Errore durante l'importazione:",T),s("error"),o(`Errore durante l'importazione: ${T instanceof Error?T.message:"Errore sconosciuto"}`)}finally{r(!1)}},m=async y=>{var E;const v=(E=y.target.files)==null?void 0:E[0];if(v)try{const T=await v.text();await h(T,`File "${v.name}"`)}catch(T){console.error("Errore nella lettura del file:",T),s("error"),o("Errore nella lettura del file"),r(!1)}};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[(a!=="idle"||S!=="idle")&&e.jsxs("div",{className:"space-y-3",children:[a!=="idle"&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${a==="success"?"bg-green-900/20 border border-green-800":"bg-red-900/20 border border-red-800"}`,children:[a==="success"?e.jsx(Je,{className:"w-5 h-5 text-green-400"}):e.jsx(at,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:`text-sm ${a==="success"?"text-green-300":"text-red-300"}`,children:n})]}),S!=="idle"&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${S==="success"?"bg-green-900/20 border border-green-800":"bg-red-900/20 border border-red-800"}`,children:[S==="success"?e.jsx(Je,{className:"w-5 h-5 text-green-400"}):e.jsx(at,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:`text-sm ${S==="success"?"text-green-300":"text-red-300"}`,children:k})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(nr,{className:"w-6 h-6 text-amber-400"}),e.jsx("h3",{className:"text-xl font-bold text-cream uppercase",children:"CARICA FILE"})]}),e.jsx("div",{className:"space-y-3 mb-6",children:e.jsxs("button",{onClick:()=>{i(!1),x(!0)},className:"w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(yt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"GOOGLE SHEETS"})]})}),e.jsxs("div",{className:"text-center py-12 mb-6",children:[e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls,.txt",onChange:m,className:"hidden",id:"modal-file-upload",disabled:t}),e.jsx("div",{className:"w-16 h-16 bg-gray-700/50 rounded-lg flex items-center justify-center mx-auto mb-6",children:e.jsx(nr,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-cream font-medium mb-2 text-lg",children:"Seleziona file"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"CSV, TXT, Excel (max 10MB)"})]}),e.jsx("div",{className:"bg-gray-800/30 border border-gray-700/50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"space-y-2 text-sm text-gray-400",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-cream",children:"Formato:"})," Nome Tipo (per riga)"]}),e.jsx("p",{children:"Solo nome e tipo vino necessari"})]})}),a!=="idle"&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg mb-4 ${a==="success"?"bg-green-900/20 border border-green-800":"bg-red-900/20 border border-red-800"}`,children:[a==="success"?e.jsx(Je,{className:"w-5 h-5 text-green-400"}):e.jsx(at,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:`text-sm ${a==="success"?"text-green-300":"text-red-300"}`,children:n})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{i(!1),s("idle"),o("")},className:"flex-1 px-4 py-3 bg-gray-700 text-cream rounded-lg hover:bg-gray-600 transition-colors",disabled:t,children:"Chiudi"})})]})})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(yt,{className:"w-6 h-6 text-blue-400"}),e.jsx("h3",{className:"text-xl font-bold text-cream uppercase",children:"GOOGLE SHEET"})]}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Incolla link Google Sheet pubblico"}),e.jsx("input",{type:"url",value:d,onChange:y=>p(y.target.value),className:"w-full px-4 py-3 bg-gray-800/70 text-cream rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400 mb-4",placeholder:"https://docs.google.com/spreadsheets/...",disabled:f}),g&&e.jsx("div",{className:"bg-gray-800/30 border border-gray-700/50 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(yt,{className:"w-5 h-5 text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-cream font-medium text-sm",children:"Google Sheet collegato"}),e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-xs",children:g})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:B,className:"p-2 text-gray-400 hover:text-cream transition-colors",title:"Modifica link",children:e.jsx(Edit,{className:"w-4 h-4"})}),e.jsx("button",{onClick:X,className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Elimina link",children:e.jsx(Trash2,{className:"w-4 h-4"})})]})]})}),S!=="idle"&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg mb-4 ${S==="success"?"bg-green-900/20 border border-green-800":"bg-red-900/20 border border-red-800"}`,children:[S==="success"?e.jsx(Je,{className:"w-5 h-5 text-green-400"}):e.jsx(at,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:`text-sm ${S==="success"?"text-green-300":"text-red-300"}`,children:k})]}),e.jsxs("div",{className:"space-y-3 text-xs text-gray-400 mb-6",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Formato:"})," Nome | Tipo"]}),e.jsx("p",{children:"Solo nome e tipo vino (rosso/bianco/bollicine/rosato)"}),e.jsx("p",{children:"Altri campi impostati automaticamente"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{x(!1),C("idle"),N("")},className:"flex-1 px-4 py-3 bg-gray-700 text-cream rounded-lg hover:bg-gray-600 transition-colors",disabled:f,children:"Chiudi"}),e.jsx("button",{onClick:F,disabled:f||!d.trim(),className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qt,{className:"w-4 h-4"}),"Importa"]})})]})]})})})]})}function wn(){const t=Oe(),{wines:r,types:a,refreshWines:s}=Ht(),{tipologie:n,loading:o,addTipologia:c,removeTipologia:x,updateTipologia:u}=bn(),[i,d]=l.useState(()=>Array.from({length:100},(b,L)=>({id:`row-${L}`,nomeVino:"",anno:"",produttore:"",provenienza:"",giacenza:0,fornitore:""}))),[p,g]=l.useState([]),[j,f]=l.useState(!1),[w,S]=l.useState(!1),[C,k]=l.useState(""),[N,z]=l.useState(""),[F,X]=l.useState([]),[B,h]=l.useState(null),[m,y]=l.useState("");l.useState(!1);const[v,E]=l.useState("BOLLICINE ITALIANE"),[T,Z]=l.useState("#cccccc"),[oe,be]=l.useState(null),[I,$]=l.useState(()=>window.innerWidth<=1024&&window.innerWidth>480&&window.innerHeight<window.innerWidth?12:14),A={BIANCO:"#cccccc","BOLLICINE ESTERE":"#f4e04d","BOLLICINE FRANCESI":"#f4e04d","BOLLICINE ITALIANE":"#f4e04d",CHAMPAGNE:"#f4e04d",FORTIFICATI:"#8b5e3c",NATURALI:"#a2d4c2","NATURALI FRIZZANTI":"#a2d4c2","RAMATI ORANGE":"#e78b43",ROSSO:"#aa1c1c"},se=[{color:"#cccccc",name:"Grigio chiaro"},{color:"#d4b000",name:"Giallo scuro"},{color:"#7b4a15",name:"Marrone scuro"},{color:"#3ca65c",name:"Verde classico"},{color:"#f08c00",name:"Arancione"},{color:"#8c1c1c",name:"Bordeaux"},{color:"#3b78c2",name:"Blu"},{color:"#000000",name:"Nero"}],M={"BOLLICINE ITALIANE":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_DIwWlGmqp3ciC47s5RBnFBPtDR-NodJOJ-BaO4zGnwpsF54l73hi7174Pc9p9ZAn8T2z_z5i7ssy/pub?gid=294419425&single=true&output=csv","BOLLICINE FRANCESI":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_DIwWlGmqp3ciC47s5RBnFBPtDR-NodJOJ-BaO4zGnwpsF54l73hi7174Pc9p9ZAn8T2z_z5i7ssy/pub?gid=700257433&single=true&output=csv",BIANCHI:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_DIwWlGmqp3ciC47s5RBnFBPtDR-NodJOJ-BaO4zGnwpsF54l73hi7174Pc9p9ZAn8T2z_z5i7ssy/pub?gid=2127910877&single=true&output=csv",ROSSI:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_DIwWlGmqp3ciC47s5RBnFBPtDR-NodJOJ-BaO4zGnwpsF54l73hi7174Pc9p9ZAn8T2z_z5i7ssy/pub?gid=254687727&single=true&output=csv",ROSATI:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_DIwWlGmqp3ciC47s5RBnFBPtDR-NodJOJ-BaO4zGnwpsF54l73hi7174Pc9p9ZAn8T2z_z5i7ssy/pub?gid=498630601&single=true&output=csv","VINI DOLCI":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_DIwWlGmqp3ciC47s5RBnFBPtDR-NodJOJ-BaO4zGnwpsF54l73hi7174Pc9p9ZAn8T2z_z5i7ssy/pub?gid=1582691495&single=true&output=csv"},W={"#":"3%",nomeVino:"30%",anno:"8%",produttore:"25%",provenienza:"20%",fornitore:"18%",giacenza:"6%",azioni:"6%"},D=()=>{try{const b=localStorage.getItem("winenode-column-widths");if(b){const L=JSON.parse(b);if(Object.keys(W).every(O=>L.hasOwnProperty(O)))return L}}catch{}return W},[H,le]=l.useState(D),[ae,Ce]=l.useState(!1),[G,K]=l.useState(null),[ce,U]=l.useState(0),[de,ge]=l.useState(0),[P,te]=l.useState({tipologia:"",search:"",fornitore:""}),[Y,Se]=l.useState(!1),[V,ue]=l.useState([]),[J,Re]=l.useState({fornitore:"",tipologie:[],isActive:!1}),we=(b,L)=>{b.preventDefault(),Ce(!0),K(L),U(b.clientX),ge(parseInt(H[L]))},Ue=b=>{if(!ae||!G)return;const L=b.clientX-ce,_=Math.max(30,de+L),O={...H,[G]:`${_}px`};le(O);try{localStorage.setItem("winenode-column-widths",JSON.stringify(O))}catch{}},ye=()=>{Ce(!1),K(null)};l.useEffect(()=>{if(ae)return document.addEventListener("mousemove",Ue),document.addEventListener("mouseup",ye),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",Ue),document.removeEventListener("mouseup",ye),document.body.style.cursor="",document.body.style.userSelect=""}},[ae,G,ce,de]),l.useEffect(()=>()=>{oe&&clearTimeout(oe)},[oe]),l.useEffect(()=>{const b=()=>{const _=window.innerWidth<=1024&&window.innerWidth>480&&window.innerHeight<window.innerWidth?12:14;I!==_&&$(_)};return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[I]);const je=()=>({fontSize:`${window.innerWidth<=1024&&window.innerWidth>480?Math.max(10,I-2):I}px`}),xe=async()=>{var L;const b=[];for(const[_,O]of Object.entries(M))try{const ne=await fetch(O);if(!ne.ok)continue;const pe=await ne.text(),re=cr.parse(pe,{skipEmptyLines:!1});let ve=0;for(let ke=0;ke<re.data.length;ke++){const ie=re.data[ke];if(ie&&ie.length>0){const me=((L=ie[0])==null?void 0:L.trim().toUpperCase())||"";if(["BIANCHI","BOLLICINE","BOLLICINE ITALIANE","BOLLICINE FRANCESI","ROSSI","ROSATI","VINI DOLCI"].includes(me)||me.includes("BOLLICINE"))continue;const he=ie.join("").toLowerCase();if(he.includes("nome vino")||he.includes("produttore")||he.includes("provenienza")||he.includes("fornitore")||he.includes("costo")||he.includes("vendita")||he.includes("margine")||he.includes("giacenza")||me==="NOME VINO"||me==="ANNO"||me==="PRODUTTORE"){ve=ke+1;continue}if(ie[0]&&ie[0].trim()&&ie[0].length>3&&!me.includes("VINI")&&!me.includes("BOLLICINE")&&!me.includes("BIANCHI")&&!me.includes("ROSSI")&&!me.includes("ROSATI")){ve=ke;break}}}const Ke=re.data.slice(ve).filter(ke=>ke&&ke[0]&&ke[0].trim()).map((ke,ie)=>{var me,he,Ie,Qe,et;return{id:`csv-${_}-${ie}`,nomeVino:((me=ke[0])==null?void 0:me.trim())||"",anno:((he=ke[1])==null?void 0:he.trim())||"",produttore:((Ie=ke[2])==null?void 0:Ie.trim())||"",provenienza:((Qe=ke[3])==null?void 0:Qe.trim())||"",fornitore:((et=ke[4])==null?void 0:et.trim())||"",giacenza:0,tipologia:_}});b.push(...Ke)}catch(ne){console.error(`Errore nel caricamento dati per ${_}:`,ne)}He(b)},Ne=async(b,L)=>{var _;try{const O=await fetch(b);if(!O.ok)throw new Error(`HTTP error ${O.status}`);const ne=await O.text(),pe=cr.parse(ne,{skipEmptyLines:!1});let re=-1,ve=0;for(let ie=0;ie<pe.data.length;ie++){const me=pe.data[ie];if(me&&me.length>0){const he=((_=me[0])==null?void 0:_.trim().toUpperCase())||"";if(["BIANCHI","BOLLICINE","BOLLICINE ITALIANE","BOLLICINE FRANCESI","ROSSI","ROSATI","VINI DOLCI"].includes(he)||he.includes("BOLLICINE"))continue;const Ie=me.join("").toLowerCase();if(Ie.includes("nome vino")||Ie.includes("produttore")||Ie.includes("provenienza")||Ie.includes("fornitore")||Ie.includes("costo")||Ie.includes("vendita")||Ie.includes("margine")||Ie.includes("giacenza")||he==="NOME VINO"||he==="ANNO"||he==="PRODUTTORE"){re=ie,ve=ie+1;continue}if(me[0]&&me[0].trim()&&me[0].length>3&&!he.includes("VINI")&&!he.includes("BOLLICINE")&&!he.includes("BIANCHI")&&!he.includes("ROSSI")&&!he.includes("ROSATI")){ve=ie;break}}}const Ke=pe.data.slice(ve).filter(ie=>ie&&ie[0]&&ie[0].trim()).map((ie,me)=>{var he,Ie,Qe,et,Xt;return{id:`csv-${L}-${me}`,nomeVino:((he=ie[0])==null?void 0:he.trim())||"",anno:((Ie=ie[1])==null?void 0:Ie.trim())||"",produttore:((Qe=ie[2])==null?void 0:Qe.trim())||"",provenienza:((et=ie[3])==null?void 0:et.trim())||"",fornitore:((Xt=ie[4])==null?void 0:Xt.trim())||"",giacenza:0}}),ke=Array.from({length:Math.max(0,100-Ke.length)},(ie,me)=>({id:`empty-${Ke.length+me}`,nomeVino:"",anno:"",produttore:"",provenienza:"",giacenza:0,fornitore:""}));d([...Ke,...ke])}catch(O){alert(`Errore nel caricamento dati per ${L}: ${O}`)}},[Ee,He]=l.useState([]);l.useEffect(()=>{(()=>{const L=Array.from(new Set(Ee.map(_=>{var O;return(O=_.fornitore)==null?void 0:O.trim()}).filter(_=>_&&_.length>0))).sort();ue(L)})()},[Ee]),l.useEffect(()=>{(!r||r.length===0)&&xe()},[]),l.useEffect(()=>{if(r&&r.length>0){const b=r.map(_=>({id:`db-${_.id}`,nomeVino:_.name||"",anno:_.vintage||"",produttore:_.description||"",provenienza:_.region||"",giacenza:_.inventory||0,fornitore:_.supplier||""})),L=Array.from({length:Math.max(0,100-b.length)},(_,O)=>({id:`row-${b.length+O}`,nomeVino:"",anno:"",produttore:"",provenienza:"",giacenza:0,fornitore:""}));d([...b,...L]),He(_=>[..._,...b])}else M[v]&&Ne(M[v],v)},[r,v]);const mt=async()=>{if(!C.trim())return;const b=C.trim().toUpperCase(),L=A[b]||T;await c(b,L)?(k(""),Z("#cccccc")):alert("Errore nell'aggiunta della tipologia o tipologia già esistente")},Be=async b=>{await x(b.id)||alert("Errore nella rimozione della tipologia")},Te=()=>{if(!N.trim()){X([]),y("");return}const b=n.filter(L=>L.nome.toLowerCase().includes(N.toLowerCase()));X(b),b.length>0&&y(b[0].nome)},We=async(b,L)=>{if(!L.trim()||L===b.nome&&T===b.colore)return;await u(b.id,L.trim().toUpperCase(),T)?(S(!1),k(""),z(""),X([]),h(null),y(""),Z("#cccccc")):alert("Errore nella modifica della tipologia o nome già esistente")},ht=(b,L)=>{if(L.ctrlKey||L.metaKey)g(_=>_.includes(b)?_.filter(O=>O!==b):[..._,b]);else if(L.shiftKey&&p.length>0){const _=p[p.length-1],O=Math.min(_,b),ne=Math.max(_,b);g(Array.from({length:ne-O+1},(pe,re)=>O+re))}else g([b])},[Jt,Ur]=l.useState(new Map),Et=(b,L,_)=>{const O=[...i];O[b]={...O[b],[L]:_},d(O);const ne=Jt.get(b);ne&&clearTimeout(ne);const pe=setTimeout(async()=>{var ve;const re=O[b];if((ve=re.nomeVino)!=null&&ve.trim())try{await Wr(re,b)}catch(It){console.error(`Errore salvataggio riga ${b+1}:`,It)}},1e3);Ur(new Map(Jt.set(b,pe)))},Br=()=>{const b={id:`row-${Date.now()}`,nomeVino:"",anno:"",produttore:"",provenienza:"",giacenza:0,fornitore:""};d(L=>[...L,b])},Yt=b=>{const L=Array.from({length:b},(_,O)=>({id:`row-${Date.now()}-${O}`,nomeVino:"",anno:"",produttore:"",provenienza:"",giacenza:0,fornitore:""}));d(_=>[..._,...L]),f(!1)},$r=()=>{const b=i.filter(_=>_.nomeVino.trim()!==""||_.anno.trim()!==""||_.produttore.trim()!==""||_.provenienza.trim()!==""||_.fornitore.trim()!==""||_.giacenza>0);d(b),g([]),f(!1);const L=i.length-b.length;alert(L>0?`${L} righe vuote eliminate`:"Nessuna riga vuota trovata")},Wr=async(b,L)=>{var _;try{if(!q.isAuthenticated()||!R)throw new Error("Utente non autenticato o Supabase non disponibile");const O=q.getUserId();if(!O)throw new Error("ID utente non disponibile");if(!((_=b.nomeVino)!=null&&_.trim()))return;const ne={user_id:O,nome_vino:b.nomeVino.trim(),anno:b.anno||"",produttore:b.produttore||"",provenienza:b.provenienza||"",fornitore:b.fornitore||"",giacenza:b.giacenza||0,updated_at:new Date().toISOString()};if(b.id&&b.id.startsWith("db-")){const pe=b.id.replace("db-",""),{error:re}=await R.from("vini").update(ne).eq("id",pe).eq("user_id",O);if(re)throw re}else{const{data:pe,error:re}=await R.from("vini").insert(ne).select().single();if(re)throw re;if(pe){const ve=[...i];ve[L].id=`db-${pe.id}`,d(ve)}}await s()}catch(O){throw console.error(`Errore nel salvataggio riga ${L+1}:`,O),O}},Vr=I*1.2,qr=I*2.5,Hr=l.useMemo(()=>J.isActive?Ee.filter(b=>{var ne,pe,re,ve;const L=!J.fornitore||((ne=b.fornitore)==null?void 0:ne.toLowerCase().includes(J.fornitore.toLowerCase())),_=J.tipologie.length===0||J.tipologie.includes("TUTTE")||J.tipologie.includes(b.tipologia||v),O=!P.search||((pe=b.nomeVino)==null?void 0:pe.toLowerCase().includes(P.search.toLowerCase()))||((re=b.produttore)==null?void 0:re.toLowerCase().includes(P.search.toLowerCase()))||((ve=b.provenienza)==null?void 0:ve.toLowerCase().includes(P.search.toLowerCase()));return L&&_&&O}):i.filter(b=>{var ne,pe,re,ve;const L=!P.tipologia||b.tipologia===P.tipologia,_=!P.search||((ne=b.nomeVino)==null?void 0:ne.toLowerCase().includes(P.search.toLowerCase()))||((pe=b.produttore)==null?void 0:pe.toLowerCase().includes(P.search.toLowerCase()))||((re=b.provenienza)==null?void 0:re.toLowerCase().includes(P.search.toLowerCase())),O=!P.fornitore||((ve=b.fornitore)==null?void 0:ve.toLowerCase().includes(P.fornitore.toLowerCase()));return L&&_&&O}),[i,Ee,P,J,v]);return e.jsxs("div",{className:"h-[95vh] flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-full mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("button",{onClick:()=>t("/settings"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alle impostazioni",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-24 w-auto object-contain"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:text-cream hover:bg-gray-800 rounded-lg transition-colors",title:"Vai alla home",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})})})]})})}),e.jsxs("main",{className:"flex-1 flex flex-col px-3 py-1 min-h-0",children:[e.jsx("div",{className:"pb-1 mb-2",children:e.jsx(vn,{})}),e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",placeholder:"Cerca vini...",value:P.search,onChange:b=>te({...P,search:b.target.value}),className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-cream placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500"}),e.jsxs("button",{onClick:()=>Se(!0),className:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-cream hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-500 min-w-[200px] text-left flex items-center justify-between",children:[e.jsx("span",{children:P.fornitore||"Filtra per fornitore..."}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[J.isActive&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-600/20 border border-blue-600/50 rounded-lg text-blue-200 text-sm",children:[e.jsxs("span",{children:["Filtro: ",J.fornitore||"Tutti i fornitori",J.tipologie.length>0&&J.tipologie.includes("TUTTE")?" - Tutte le tipologie":J.tipologie.length>0?` - ${J.tipologie.length} tipologie`:""]}),e.jsx("button",{onClick:()=>{Re({fornitore:"",tipologie:[],isActive:!1}),te({...P,fornitore:""})},className:"ml-1 hover:text-blue-100",title:"Rimuovi filtro modale",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),!J.isActive&&P.fornitore&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-amber-600/20 border border-amber-600/50 rounded-lg text-amber-200 text-sm",children:[e.jsxs("span",{children:["Fornitore: ",P.fornitore]}),e.jsx("button",{onClick:()=>te({...P,fornitore:""}),className:"ml-1 hover:text-amber-100",title:"Rimuovi filtro fornitore",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$(b=>Math.max(10,b-5)),className:"flex items-center justify-center px-2 py-2 bg-[#3A1E18] hover:border-[#A97B50] hover:shadow-md text-[#F5EEDC] rounded-md transition-all text-sm font-bold",disabled:I<=10,style:{opacity:I<=10?.5:1},children:"-"}),e.jsx("button",{className:"flex items-center gap-2 px-3 py-2 bg-[#3A1E18] hover:border-[#A97B50] hover:shadow-md text-[#F5EEDC] transition-all text-sm font-medium rounded-md",style:{cursor:"default"},children:"Aa"}),e.jsx("button",{onClick:()=>$(b=>Math.min(24,b+5)),className:"flex items-center justify-center px-2 py-2 bg-[#3A1E18] hover:border-[#A97B50] hover:shadow-md text-[#F5EEDC] rounded-md transition-all text-sm font-bold",disabled:I>=24,style:{opacity:I>=24?.5:1},children:"+"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>console.log("Esporta"),className:"flex items-center gap-2 bg-[#3A1E18] text-[#F5EEDC] rounded-md px-3 py-2 text-sm shadow-sm hover:border-[#A97B50] hover:shadow-md transition-all",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Esporta"]}),e.jsxs("button",{onClick:()=>{const b={timestamp:new Date().toISOString(),vini:i.filter(pe=>pe.nomeVino.trim()||pe.produttore.trim()),tipologie:n},L=JSON.stringify(b,null,2),_=new Blob([L],{type:"application/json"}),O=URL.createObjectURL(_),ne=document.createElement("a");ne.href=O,ne.download=`winenode-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne),URL.revokeObjectURL(O),alert("Backup creato e scaricato con successo!")},className:"flex items-center gap-2 bg-[#3A1E18] text-[#F5EEDC] rounded-md px-3 py-2 text-sm shadow-sm hover:border-[#A97B50] hover:shadow-md transition-all",title:"Crea backup dati",children:[e.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7,10 12,15 17,10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Backup"]})]})]}),e.jsx("div",{className:"bg-black/30 border-b border-red-900/30 px-4 py-4",children:e.jsx("div",{className:"max-w-full mx-auto",children:e.jsx("div",{className:"flex items-center justify-center flex-wrap gap-2",children:["BOLLICINE ITALIANE","BOLLICINE FRANCESI","BIANCHI","ROSSI","ROSATI","VINI DOLCI"].map(b=>e.jsx("button",{onClick:()=>{J.isActive||(E(b),M[b]&&Ne(M[b],b))},disabled:J.isActive,className:`px-6 py-3 font-semibold text-sm rounded-lg transition-all duration-200 border-2 ${J.isActive?"bg-gray-500/40 text-gray-400 border-gray-400/40 cursor-not-allowed opacity-50":v===b?"bg-amber-700 text-cream border-amber-500 shadow-lg":"bg-brown-800/60 text-cream/80 border-brown-600/40 hover:bg-brown-700/70 hover:border-brown-500/60"}`,style:{backgroundColor:J.isActive?"#6b728080":v===b?"#b45309":"#5d2f0a80",borderColor:J.isActive?"#9ca3af60":v===b?"#f59e0b":"#8b4513aa"},children:b},b))})})}),e.jsx("div",{className:"rounded-lg shadow-2xl border border-amber-900 overflow-hidden flex-1 min-h-0",style:{backgroundColor:"#8B4513"},children:e.jsxs("div",{className:"h-full overflow-x-hidden overflow-y-auto",children:[e.jsxs("table",{className:"w-full table-fixed",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{className:"sticky top-0 z-30 shadow-lg",style:{backgroundColor:"#3b1d1d"},children:e.jsxs("tr",{style:{fontSize:`${I}px`,lineHeight:`${Vr}px`,height:`${qr}px`},children:[e.jsx("th",{className:"px-2 py-3 text-center align-middle font-bold text-white border border-amber-900 border-r-2 border-r-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm",style:{width:H["#"]}}),e.jsxs("th",{className:"px-3 py-3 text-center align-middle font-bold text-white border border-amber-900 border-r-2 border-r-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm relative group",style:{width:H.nomeVino},children:["Nome Vino",e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize group-hover:bg-amber-600/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:b=>we(b,"nomeVino"),title:"Ridimensiona colonna",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"}),e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"})]})})]}),e.jsxs("th",{className:"px-3 py-3 text-center align-middle font-bold text-white border border-amber-900 border-r-2 border-r-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm relative group",style:{width:H.anno},children:["Anno",e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize group-hover:bg-amber-600/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:b=>we(b,"anno"),title:"Ridimensiona colonna",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"}),e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"})]})})]}),e.jsxs("th",{className:"px-3 py-3 text-center align-middle font-bold text-white border border-amber-900 border-r-2 border-r-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm relative group",style:{width:H.produttore},children:["Produttore",e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize group-hover:bg-amber-600/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:b=>we(b,"produttore"),title:"Ridimensiona colonna",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"}),e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"})]})})]}),e.jsxs("th",{className:"px-3 py-3 text-center align-middle font-bold text-white border border-amber-900 border-r-2 border-r-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm relative group",style:{width:H.provenienza},children:["Provenienza",e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize group-hover:bg-amber-600/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:b=>we(b,"provenienza"),title:"Ridimensiona colonna",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"}),e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"})]})})]}),e.jsxs("th",{className:"px-3 py-3 text-center align-middle font-bold text-white border border-amber-900 border-r-2 border-r-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm relative group",style:{width:H.fornitore},children:["Fornitore",e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize group-hover:bg-amber-600/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:b=>we(b,"fornitore"),title:"Ridimensiona colonna",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"}),e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"})]})})]}),e.jsxs("th",{className:"px-1 py-3 text-center align-middle font-bold text-white border border-amber-900 border-r-2 border-r-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm relative group",style:{width:H.giacenza},children:["GIACENZA",e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full cursor-col-resize group-hover:bg-amber-600/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:b=>we(b,"giacenza"),title:"Ridimensiona colonna",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"}),e.jsx("div",{className:"w-0.5 h-4 bg-amber-600"})]})})]}),e.jsx("th",{className:"px-2 py-3 text-center align-middle font-bold text-white border border-amber-900 uppercase bg-[#3b1d1d] backdrop-blur-sm",style:{width:H.azioni}})]})}),e.jsx("tbody",{children:Hr.map((b,L)=>{const _=p.includes(L),O=_?"#E6D7B8":"#F5F0E6",ne=_?"2px":"1px",pe=_?"#D97706":"#92400e";return e.jsxs("tr",{onClick:re=>ht(L,re),className:"cursor-pointer transition-all duration-200 hover:bg-opacity-80",style:{backgroundColor:O,borderWidth:ne,borderColor:pe},children:[e.jsx("td",{className:"border border-amber-900 p-0",style:{backgroundColor:O,width:H["#"]},children:e.jsx("div",{className:"w-full px-2 py-2 text-center text-gray-600 font-medium select-none flex items-center justify-center",style:{fontSize:I*.7,userSelect:"none",height:40},children:L+1})}),e.jsx("td",{className:"border border-amber-900 p-0",style:{backgroundColor:O,width:H.nomeVino},children:e.jsx("div",{className:"w-full px-2 py-2 bg-transparent border-none outline-none text-gray-600 text-center select-none flex items-center justify-center",style:{backgroundColor:O,userSelect:"none",...je(),height:40,lineHeight:"normal"},children:b.nomeVino})}),e.jsx("td",{className:"border border-amber-900 p-0",style:{backgroundColor:O,width:H.anno},children:e.jsx("div",{className:"w-full px-2 py-2 bg-transparent border-none outline-none text-gray-600 text-center select-none flex items-center justify-center",style:{backgroundColor:O,userSelect:"none",...je(),height:40,lineHeight:"normal"},children:b.anno})}),e.jsx("td",{className:"border border-amber-900 p-0",style:{backgroundColor:O,width:H.produttore},children:e.jsx("div",{className:"w-full px-2 py-2 bg-transparent border-none outline-none text-gray-600 text-center select-none flex items-center justify-center",style:{backgroundColor:O,userSelect:"none",...je(),height:40,lineHeight:"normal"},children:b.produttore})}),e.jsx("td",{className:"border border-amber-900 p-0",style:{backgroundColor:O,width:H.provenienza},children:e.jsx("div",{className:"w-full px-2 py-2 bg-transparent border-none outline-none text-gray-600 text-center select-none flex items-center justify-center",style:{backgroundColor:O,userSelect:"none",...je(),height:40,lineHeight:"normal"},children:b.provenienza})}),e.jsx("td",{className:"border border-amber-900 p-0",style:{backgroundColor:O,width:H.fornitore},children:e.jsx("div",{className:"w-full px-2 py-2 bg-transparent border-none outline-none text-gray-600 text-center select-none flex items-center justify-center",style:{backgroundColor:O,userSelect:"none",...je(),height:40,lineHeight:"normal"},children:b.fornitore})}),e.jsx("td",{className:"border border-amber-900 p-0 group",style:{backgroundColor:O,width:H.giacenza},children:e.jsxs("div",{className:"relative flex items-center justify-center h-full",children:[e.jsx("button",{onClick:re=>{re.stopPropagation(),Et(L,"giacenza",Math.max(0,b.giacenza-1).toString())},className:"absolute left-1 w-4 h-4 bg-red-500 hover:bg-red-600 text-white rounded-full text-xs font-bold opacity-0 group-hover:opacity-100 transition-all duration-200 flex items-center justify-center shadow-sm",style:{fontSize:10},title:"Diminuisci giacenza",children:"-"}),e.jsx("input",{type:"number",value:b.giacenza,onChange:re=>Et(L,"giacenza",re.target.value),className:"w-full px-1 py-2 bg-transparent border-none outline-none text-gray-600 focus:bg-white focus:shadow-inner text-center select-none font-bold",style:{backgroundColor:O,userSelect:"none",...je(),height:40,lineHeight:"normal"},min:"0"}),e.jsx("button",{onClick:re=>{re.stopPropagation(),Et(L,"giacenza",(Number(b.giacenza)+1).toString())},className:"absolute right-1 w-4 h-4 bg-green-500 hover:bg-green-600 text-white rounded-full text-xs font-bold opacity-0 group-hover:opacity-100 transition-all duration-200 flex items-center justify-center shadow-sm",style:{fontSize:10},title:"Aumenta giacenza",children:"+"})]})}),e.jsx("td",{className:"border border-amber-900 p-0",style:{backgroundColor:O,width:H.azioni},children:e.jsx("div",{className:"flex items-center justify-center gap-2 h-full",style:{height:40}})})]},b.id)})})]}),e.jsx("div",{className:"sticky bottom-0 z-40 bg-[#8B4513] border-t-2 border-amber-900 shadow-lg",children:e.jsx("button",{onClick:Br,className:"w-full border border-amber-900 p-3 text-white font-medium hover:bg-amber-200 transition-colors",style:{backgroundColor:"#2d0505",fontSize:I,height:40,display:"flex",alignItems:"center",justifyContent:"center"},children:"Aggiungi"})})]})}),j&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-800 rounded-md shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Aggiungi Righe"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>Yt(5),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-700 transition-colors",children:"Aggiungi 5 Righe"}),e.jsx("button",{onClick:()=>Yt(10),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-700 transition-colors",children:"Aggiungi 10 Righe"}),e.jsx("button",{onClick:$r,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Pulisci Righe Vuote"}),e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Annulla"})]})]})]}),e.jsx("footer",{className:"border-t border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-full mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-center h-16"})})}),w&&e.jsx("div",{className:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-md shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Gestisci Tipologie"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-md font-semibold mb-2",children:"Aggiungi Nuova Tipologia"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:b=>k(b.target.value),placeholder:"Nome tipologia",className:"w-full px-3 py-2 border rounded-md"}),e.jsx("select",{value:T,onChange:b=>Z(b.target.value),className:"w-full px-3 py-2 border rounded-md",children:se.map(b=>e.jsx("option",{value:b.color,children:b.name},b.color))})]}),e.jsx("button",{onClick:mt,className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors w-full",children:"Aggiungi"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-md font-semibold mb-2",children:"Modifica Tipologia Esistente"}),e.jsx("input",{type:"text",placeholder:"Cerca tipologia...",value:N,onChange:b=>{z(b.target.value),Te()},className:"w-full px-3 py-2 border rounded-md"}),F.length>0?e.jsx("ul",{children:F.map(b=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{children:b.nome}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:L=>y(L.target.value),className:"px-3 py-1 border rounded-md"}),e.jsx("select",{value:T,onChange:L=>Z(L.target.value),className:"w-full px-3 py-2 border rounded-md",children:se.map(L=>e.jsx("option",{value:L.color,children:L.name},L.color))}),e.jsx("button",{onClick:()=>We(b,m),className:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"Salva"}),e.jsx("button",{onClick:()=>Be(b),className:"px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors",children:"Elimina"})]})]},b.id))}):e.jsx("p",{children:"Nessuna tipologia trovata."})]}),e.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400 transition-colors w-full",children:"Chiudi"})]})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-md max-h-[85vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800/50",children:[e.jsxs("h3",{className:"text-xl font-bold text-cream flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtro Avanzato"]}),e.jsx("button",{onClick:()=>Se(!1),className:"text-gray-400 hover:text-cream p-1 rounded-lg hover:bg-gray-700 transition-colors",title:"Chiudi",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4 max-h-96 overflow-y-auto space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-cream mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Fornitore"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>Re(b=>({...b,fornitore:""})),className:`w-full p-3 text-left rounded-lg transition-all duration-200 ${J.fornitore?"bg-gray-800 hover:bg-gray-700 text-cream border border-gray-600":"bg-amber-600/20 border-2 border-amber-500/60 text-amber-100"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${J.fornitore?"bg-gray-500":"bg-amber-400"}`}),e.jsx("span",{className:"font-medium",children:"Tutti i fornitori"})]})}),V.map(b=>e.jsx("button",{onClick:()=>Re(L=>({...L,fornitore:b})),className:`w-full p-3 text-left rounded-lg transition-all duration-200 ${J.fornitore===b?"bg-amber-600/20 border-2 border-amber-500/60 text-amber-100":"bg-gray-800 hover:bg-gray-700 text-cream border border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${J.fornitore===b?"bg-amber-400":"bg-gray-500"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:b}),e.jsxs("div",{className:"text-sm opacity-70",children:[Ee.filter(L=>L.fornitore===b).length," vini"]})]})]})},b))]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-cream mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"Tipologie"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>Re(b=>({...b,tipologie:["TUTTE"]})),className:`w-full p-3 text-left rounded-lg transition-all duration-200 ${J.tipologie.includes("TUTTE")?"bg-green-600/20 border-2 border-green-500/60 text-green-100":"bg-gray-800 hover:bg-gray-700 text-cream border border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${J.tipologie.includes("TUTTE")?"bg-green-400":"bg-gray-500"}`}),e.jsx("span",{className:"font-medium",children:"Tutte le tipologie"})]})}),["BOLLICINE ITALIANE","BOLLICINE FRANCESI","BIANCHI","ROSSI","ROSATI","VINI DOLCI"].map(b=>e.jsx("button",{onClick:()=>{Re(L=>{const _=L.tipologie.includes("TUTTE")?[b]:L.tipologie.includes(b)?L.tipologie.filter(O=>O!==b):[...L.tipologie.filter(O=>O!=="TUTTE"),b];return{...L,tipologie:_}})},className:`w-full p-3 text-left rounded-lg transition-all duration-200 ${J.tipologie.includes(b)&&!J.tipologie.includes("TUTTE")?"bg-green-600/20 border-2 border-green-500/60 text-green-100":"bg-gray-800 hover:bg-gray-700 text-cream border border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${J.tipologie.includes(b)&&!J.tipologie.includes("TUTTE")?"bg-green-400":"bg-gray-500"}`}),e.jsx("span",{className:"font-medium",children:b})]})},b))]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 bg-gray-800/30 space-y-3",children:[e.jsxs("button",{onClick:()=>{Re(b=>({...b,isActive:!0})),Se(!1)},className:"w-full px-4 py-3 bg-blue-600 text-cream rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Applica Filtro"]}),e.jsx("button",{onClick:()=>Se(!1),className:"w-full px-4 py-3 bg-gray-700 text-cream rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"Annulla"})]})]})})]})}function jn(){const t=Oe();return e.jsxs("div",{className:"min-h-screen flex flex-col",style:{background:"#2e0d0d"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-full mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("button",{onClick:()=>t("/settings/archivi"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna agli archivi",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-24 w-auto object-contain"}),e.jsx("div",{className:"w-10"})]})})}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-white text-center",children:e.jsx("p",{className:"text-lg",children:"Pagina vuota"})})})]})}function Nn(){const t=Oe(),[r,a]=l.useState(null),[s,n]=l.useState(!1);l.useEffect(()=>{(async()=>{if(!ee||!R)return;const{data:{user:w}}=await R.auth.getUser();w&&a(w)})()},[]);const o=async()=>{try{if(!ee||!R){localStorage.clear(),sessionStorage.clear(),window.location.href="/";return}const{error:f}=await R.auth.signOut();f&&(console.error("Errore durante il logout:",f),localStorage.clear(),sessionStorage.clear()),window.location.href="/"}catch(f){console.error("Errore durante il logout:",f),localStorage.clear(),sessionStorage.clear(),window.location.href="/"}},c=f=>{f==="logout"?o():f==="email"?x():f==="password"?u():f==="profile"?i():f==="notifications"?d():f==="reset"&&p()},x=()=>{const f=prompt("Inserisci il nuovo indirizzo email:",(r==null?void 0:r.email)||"");if(f&&f!==(r==null?void 0:r.email)){if(!ee||!R){alert("Modifica email non disponibile - servizio di autenticazione non configurato");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f)){alert("⚠️ Inserisci un indirizzo email valido");return}R.auth.updateUser({email:f}).then(({error:S})=>{alert(S?"❌ Errore durante la modifica dell'email: "+S.message:`✅ Richiesta di modifica email inviata!

Controlla la tua casella email attuale per confermare il cambiamento.`)})}},u=()=>{const f=prompt("Inserisci la nuova password (minimo 6 caratteri):");if(f){if(!ee||!R){alert("Modifica password non disponibile - servizio di autenticazione non configurato");return}if(f.length<6){alert("⚠️ La password deve essere di almeno 6 caratteri");return}R.auth.updateUser({password:f}).then(({error:w})=>{alert(w?"❌ Errore durante la modifica della password: "+w.message:"✅ Password aggiornata con successo!")})}},i=()=>{n(!0)},d=()=>{alert("Funzionalità notifiche in sviluppo")},p=()=>{confirm(`⚠️ ATTENZIONE!

Questa operazione eliminerà TUTTI i tuoi dati:
- Vini in archivio
- Fornitori
- Impostazioni personalizzate

Questa azione è IRREVERSIBILE.

Sei sicuro di voler continuare?`)&&confirm(`🔴 ULTIMA CONFERMA

Stai per eliminare DEFINITIVAMENTE tutti i tuoi dati.

Digita "CONFERMA" per procedere o annulla per tornare indietro.`)&&g()},g=async()=>{try{if(!ee||!R){localStorage.clear(),sessionStorage.clear(),alert("✅ Dati locali puliti con successo!"),window.location.href="/";return}const{data:{user:f}}=await R.auth.getUser();if(!f){alert("❌ Errore: utente non autenticato");return}const{error:w}=await R.from("giacenze").delete().eq("user_id",f.id);w&&console.error("Errore nell'eliminazione vini:",w);const{error:S}=await R.from("fornitori").delete().eq("user_id",f.id);S&&console.error("Errore nell'eliminazione fornitori:",S),localStorage.clear(),sessionStorage.clear(),alert(`✅ Reset completato con successo!

Tutti i tuoi dati sono stati eliminati.`),window.location.href="/"}catch(f){console.error("Errore durante il reset:",f),alert("❌ Errore durante il reset dei dati. Riprova.")}},j=[{id:"email",title:"EMAIL",icon:St},{id:"password",title:"PASSWORD",icon:Tr},{id:"profile",title:"PROFILO",icon:Or},{id:"notifications",title:"NOTIFICHE",icon:Wt},{id:"reset",title:"RESET",icon:it},{id:"logout",title:"ESCI",icon:Vt}];return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:()=>t("/settings"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alle impostazioni",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:text-cream hover:bg-gray-800 rounded-lg transition-colors",title:"Vai alla home",style:{filter:"brightness(1.2)",color:"#ffffff"},children:e.jsx($e,{className:"h-6 w-6"})})]})})}),e.jsxs("main",{className:"flex-1 flex flex-col max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:j.map(f=>{const w=f.icon;return e.jsx("div",{onClick:()=>c(f.id),className:"bg-gray-800/50 border border-gray-700 p-3 rounded-xl text-left transition-all duration-200 group hover:bg-gray-700/50 hover:border-gray-600 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-700/50 rounded-lg group-hover:bg-gray-600/50 transition-colors",children:e.jsx(w,{className:"h-4 w-4 text-gray-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-cream",children:f.title}),f.id==="email"&&(r==null?void 0:r.email)&&e.jsxs("p",{className:"text-xs text-blue-400 mt-1",children:["Attuale: ",r.email]})]})]})},f.id)})}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mt-auto text-center",children:e.jsxs("div",{className:"text-gray-400",style:{fontSize:"8px"},children:[e.jsx("div",{className:"mb-1",children:"Versione: 1.0.0"}),e.jsxs("div",{children:["Ultimo aggiornamento: ",new Date().toLocaleDateString("it-IT")," -"," ",new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsx(Mr,{open:s,onOpenChange:n,user:r})]})]})}function kn(){const t=Oe(),[r,a]=l.useState(!1),[s,n]=l.useState(!1),[o,c]=l.useState(!1),x=[{id:"language",title:"LINGUA",icon:yt},{id:"notifications",title:"NOTIFICHE",icon:Wt},{id:"testmode",title:"RISOLUZIONI",icon:en},{id:"reset",title:"RESET",icon:it}],u=async()=>{await q.signOut()&&t("/")},i=async()=>{c(!0);try{if(!ee||!q.isAuthenticated())throw new Error("Supabase non configurato o utente non autenticato");const d=q.getUserId();if(!d)throw new Error("ID utente non disponibile");const{supabase:p}=await dr(()=>Promise.resolve().then(()=>Bs),void 0,import.meta.url),{error:g}=await p.from("giacenze").delete().eq("user_id",d);if(g)throw console.error("Errore nell'eliminazione vini:",g),g;const{error:j}=await p.from("fornitori").delete().eq("user_id",d);if(j)throw console.error("Errore nell'eliminazione fornitori:",j),j;console.log("Reset completato con successo"),n(!1),a(!1),t("/")}catch(d){console.error("Errore durante il reset:",d),alert("Errore durante il reset dei dati. Riprova.")}finally{c(!1)}};return e.jsxs("div",{className:"h-screen max-h-screen overflow-hidden flex flex-col",style:{background:"linear-gradient(to bottom right, #1f0202, #2d0505, #1f0202)"},children:[e.jsx("header",{className:"border-b border-red-900/30 bg-black/30 backdrop-blur-sm flex-shrink-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsx("button",{onClick:()=>t("/settings"),className:"p-2 text-white hover:text-cream hover:bg-white/10 rounded-full transition-all duration-200 hover:scale-105",title:"Torna alle impostazioni",style:{filter:"brightness(1.3)",backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),e.jsx("img",{src:"/logo 2 CCV.png",alt:"WINENODE",className:"h-32 w-auto object-contain"}),e.jsx("button",{onClick:()=>t("/"),className:"p-2 text-white hover:bg-gray-700 rounded-lg transition-colors",title:"Torna alla home",children:e.jsx($e,{className:"h-6 w-6"})})]})})}),e.jsxs("main",{className:"flex-1 flex flex-col max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:x.map(d=>{const p=d.icon;return e.jsx("div",{className:"bg-gray-800/50 border border-gray-700 p-3 rounded-xl text-left transition-all duration-200 group hover:bg-gray-700/50 hover:border-gray-600 cursor-pointer",onClick:()=>{console.log(`Clicked on ${d.id}`),d.id==="reset"?(console.log("Opening reset confirmation..."),a(!0)):d.id==="language"?alert("Funzionalità lingua in sviluppo"):d.id==="notifications"?alert("Funzionalità notifiche in sviluppo"):d.id==="testmode"&&alert("Funzionalità test in sviluppo")},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-700/50 rounded-lg group-hover:bg-gray-600/50 transition-colors",children:e.jsx(p,{className:"h-4 w-4 text-gray-300"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"text-sm font-bold text-cream",children:d.title})}),e.jsx(ot,{className:"h-4 w-4 text-gray-500 group-hover:text-gray-400 transition-colors"})]})},d.id)})}),ee&&e.jsx("div",{className:"mt-8",children:e.jsxs("button",{onClick:u,className:"w-full bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(Vt,{className:"h-5 w-5"}),"DISCONNETTI"]})}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mt-auto text-center",children:e.jsxs("div",{className:"text-gray-400",style:{fontSize:"8px"},children:[e.jsx("div",{className:"mb-1",children:"Versione: 1.0.0"}),e.jsxs("div",{children:["Ultimo aggiornamento: ",new Date().toLocaleDateString("it-IT")," -"," ",new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})]})]})})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg w-full max-w-md",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 bg-red-600 rounded-full flex items-center justify-center",children:e.jsx(it,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-cream mb-2",children:"Reset Completo"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Sei sicuro di voler resettare tutti i dati? Questa operazione eliminerà:"}),e.jsxs("ul",{className:"text-left text-gray-300 mb-6 space-y-1",children:[e.jsx("li",{children:"• Tutti i vini del tuo inventario"}),e.jsx("li",{children:"• Tutti i fornitori"}),e.jsx("li",{children:"• Tutte le giacenze"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>a(!1),className:"flex-1 px-4 py-2 bg-gray-700 text-cream rounded-lg hover:bg-gray-600 transition-colors",children:"Annulla"}),e.jsx("button",{onClick:()=>{console.log("First confirmation accepted, showing final confirmation..."),a(!1),n(!0)},className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Continua"})]})]})})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 border border-red-500 rounded-lg w-full max-w-md",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 bg-red-700 rounded-full flex items-center justify-center",children:e.jsx(Lr,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-red-400 mb-2",children:"ATTENZIONE!"}),e.jsxs("p",{className:"text-gray-300 mb-4",children:["Questa operazione è ",e.jsx("strong",{className:"text-red-400",children:"IRREVERSIBILE"}),"."]}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Tutti i tuoi dati verranno eliminati definitivamente. Sei assolutamente sicuro?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>n(!1),className:"flex-1 px-4 py-2 bg-gray-700 text-cream rounded-lg hover:bg-gray-600 transition-colors",disabled:o,children:"No, annulla"}),e.jsx("button",{onClick:()=>{console.log("Final confirmation accepted, starting reset..."),i()},disabled:o,className:"flex-1 px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-800 transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Resettando..."]}):"Sì, elimina tutto"})]})]})})})]})}function Sn(){const[t,r]=l.useState(!1),[a,s]=l.useState(!0),[n,o]=l.useState(null),[c,x]=l.useState(!0),[u,i]=l.useState(!1),[d,p]=l.useState(!1);return l.useEffect(()=>{const g=j=>{const f=j.target;f.tagName==="INPUT"||f.tagName==="TEXTAREA"||j.key==="s"&&j.ctrlKey&&(j.preventDefault(),p(!d))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[d]),l.useEffect(()=>{if(console.log("🔧 App startup - Supabase available:",ee),console.log("🌐 Current URL:",window.location.href),!ee){i(!0),x(!1);return}return q.onAuthStateChange(j=>{console.log("👤 Auth state changed:",j?"Logged in":"Logged out"),r(!!j),o(j?{access_token:j.token,token_type:"Bearer",expires_in:3600,refresh_token:j.refreshToken,user:j}:null),s(!1)})},[]),a?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-cream",children:"Caricamento..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-900",children:[e.jsxs(ss,{children:[e.jsx(Le,{path:"/",element:n||u?e.jsx(sn,{}):e.jsx(gt,{})}),e.jsx(Le,{path:"/settings",element:n||u?e.jsx(on,{}):e.jsx(gt,{})}),e.jsx(Le,{path:"/settings/fornitori",element:n||u?e.jsx(xn,{}):e.jsx(gt,{})}),e.jsx(Le,{path:"/settings/archivi",element:e.jsx(wn,{})}),e.jsx(Le,{path:"/settings/archivi/importa",element:e.jsx(jn,{})}),e.jsx(Le,{path:"/settings/archivi/manuale",element:e.jsx(lr,{})}),e.jsx(Le,{path:"/settings/google-sheets",element:e.jsx(or,{})}),e.jsx(Le,{path:"/settings/preferenze",element:e.jsx(kn,{})}),e.jsx(Le,{path:"/settings/account",element:e.jsx(Nn,{})}),e.jsx(Le,{path:"/google-sheets",element:n||u?e.jsx(or,{}):e.jsx(gt,{})}),e.jsx(Le,{path:"/manual-wine-insert",element:e.jsx(lr,{})}),e.jsx(Le,{path:"/saldo",element:e.jsx(ir,{})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>p(!1),children:e.jsxs("div",{onClick:g=>g.stopPropagation(),children:[e.jsx(ir,{}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Chiudi (o premi Ctrl+S)"})})]})})]})}At.createRoot(document.getElementById("root")).render(e.jsx(Ge.StrictMode,{children:e.jsx(Rs,{children:e.jsx(Sn,{})})}));
